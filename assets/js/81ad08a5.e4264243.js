"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1006],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(n),k=r,d=m["".concat(o,".").concat(k)]||m[k]||c[k]||l;return n?a.createElement(d,i(i({ref:t},u),{},{components:n})):a.createElement(d,i({ref:t},u))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<l;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},36997:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const l={index:6,title:"SpringSecurity"},i=void 0,s={unversionedId:"Java/fm/SpringSecurity",id:"Java/fm/SpringSecurity",title:"SpringSecurity",description:"- Spring Security \u57fa\u7840",source:"@site/docs/Java/fm/SpringSecurity.md",sourceDirName:"Java/fm",slug:"/Java/fm/SpringSecurity",permalink:"/Computer-Science-Learn-Notes/docs/Java/fm/SpringSecurity",draft:!1,editUrl:"https://github.com/zhiyu1998/Computer-Science-Learn-Notes/edit/master/docs/Java/fm/SpringSecurity.md",tags:[],version:"current",frontMatter:{index:6,title:"SpringSecurity"},sidebar:"sidebars",previous:{title:"SpringDataJpa",permalink:"/Computer-Science-Learn-Notes/docs/Java/fm/SpringDataJpa"},next:{title:"SpringCloud",permalink:"/Computer-Science-Learn-Notes/docs/Java/fm/SpringCloud"}},o={},p=[{value:"Spring Security \u5bf9\u6bd4 Shiro",id:"spring-security-\u5bf9\u6bd4-shiro",level:2},{value:"Spring Security \u6838\u5fc3",id:"spring-security-\u6838\u5fc3",level:3},{value:"\u5bf9\u6bd4shiro",id:"\u5bf9\u6bd4shiro",level:3},{value:"Http Basic\u8ba4\u8bc1\u6a21\u5f0f",id:"http-basic\u8ba4\u8bc1\u6a21\u5f0f",level:2},{value:"Http Basic\u4e0d\u591f\u5b89\u5168\u7684\u539f\u56e0",id:"http-basic\u4e0d\u591f\u5b89\u5168\u7684\u539f\u56e0",level:3},{value:"POSTMAN\u6d4b\u8bd5",id:"postman\u6d4b\u8bd5",level:4},{value:"HttpBasic\u6a21\u5f0f\u7684\u539f\u7406\u8bf4\u660e",id:"httpbasic\u6a21\u5f0f\u7684\u539f\u7406\u8bf4\u660e",level:4},{value:"Hash\u7b97\u6cd5",id:"hash\u7b97\u6cd5",level:2},{value:"PasswordEncoder \u63a5\u53e3",id:"passwordencoder-\u63a5\u53e3",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:4},{value:"\u6d4b\u8bd5\u7ed3\u8bba",id:"\u6d4b\u8bd5\u7ed3\u8bba",level:4},{value:"formLogin\u767b\u5f55\u6a21\u5f0f",id:"formlogin\u767b\u5f55\u6a21\u5f0f",level:2},{value:"\u8ba4\u8bc1\u521d\u4f53\u9a8c",id:"\u8ba4\u8bc1\u521d\u4f53\u9a8c",level:3},{value:"\u767b\u5f55\u8ba4\u8bc1\u53ca\u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u7684\u63a7\u5236\u3010\u91cd\u8981\u3011",id:"\u767b\u5f55\u8ba4\u8bc1\u53ca\u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u7684\u63a7\u5236\u91cd\u8981",level:4},{value:"\u521b\u5efa\u81ea\u5b9a\u4e49\u89d2\u8272",id:"\u521b\u5efa\u81ea\u5b9a\u4e49\u89d2\u8272",level:4},{value:"\u5f00\u653e\u9759\u6001\u8d44\u6e90",id:"\u5f00\u653e\u9759\u6001\u8d44\u6e90",level:4},{value:"\u6e90\u7801\u89e3\u6790",id:"\u6e90\u7801\u89e3\u6790",level:3},{value:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u767b\u5f55\u5904\u7406\u3010\u91cd\u8981\u3011",id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u767b\u5f55\u5904\u7406\u91cd\u8981",level:3},{value:"\u540e\u7aef\u5904\u7406 JSON",id:"\u540e\u7aef\u5904\u7406-json",level:4},{value:"\u524d\u7aef\u5904\u7406",id:"\u524d\u7aef\u5904\u7406",level:4},{value:"Session\u4f1a\u8bdd\u5b89\u5168\u7ba1\u7406\u5668",id:"session\u4f1a\u8bdd\u5b89\u5168\u7ba1\u7406\u5668",level:3},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:4},{value:"\u4ee5\u4e0b\u65b9\u6cd5\u90fd\u662f\u5728HttpSecurity\u65b9\u6cd5\u4e2d\u548c\u914d\u7f6e\u4e2d\u5b9e\u73b0 \u2193",id:"\u4ee5\u4e0b\u65b9\u6cd5\u90fd\u662f\u5728httpsecurity\u65b9\u6cd5\u4e2d\u548c\u914d\u7f6e\u4e2d\u5b9e\u73b0-",level:4},{value:"session\u8d85\u65f6",id:"session\u8d85\u65f6",level:4},{value:"session\u4fdd\u62a4",id:"session\u4fdd\u62a4",level:4},{value:"cookie\u5b89\u5168",id:"cookie\u5b89\u5168",level:4},{value:"\u540c\u8d26\u53f7\u591a\u7aef\u767b\u5f55\u8e22\u4e0b\u7ebf",id:"\u540c\u8d26\u53f7\u591a\u7aef\u767b\u5f55\u8e22\u4e0b\u7ebf",level:4},{value:"RBAC\u6743\u9650\u6a21\u578b",id:"rbac\u6743\u9650\u6a21\u578b",level:2},{value:"\u52a8\u6001\u52a0\u8f7dRBAC\u6570\u636e",id:"\u52a8\u6001\u52a0\u8f7drbac\u6570\u636e",level:2},{value:"\u5b9e\u73b0Dao\u5c42\u63a5\u53e3\u548cService\u63a5\u53e3",id:"\u5b9e\u73b0dao\u5c42\u63a5\u53e3\u548cservice\u63a5\u53e3",level:3},{value:"\u5b9e\u73b0Dao\u5c42",id:"\u5b9e\u73b0dao\u5c42",level:4},{value:"\u5b9e\u73b0Service\u5c42",id:"\u5b9e\u73b0service\u5c42",level:4},{value:"\u5b9e\u73b0\u540e\u7684\u914d\u7f6e",id:"\u5b9e\u73b0\u540e\u7684\u914d\u7f6e",level:4},{value:"\u8d44\u6e90\u9274\u6743\u89c4\u5219",id:"\u8d44\u6e90\u9274\u6743\u89c4\u5219",level:3},{value:"\u521b\u5efa\u4e00\u4e2aRBAC\u7c7b",id:"\u521b\u5efa\u4e00\u4e2arbac\u7c7b",level:4},{value:"\u914d\u7f6e\u7c7b\u66f4\u6362",id:"\u914d\u7f6e\u7c7b\u66f4\u6362",level:4},{value:"SPEL\u6743\u9650\u8868\u8fbe\u5f0f",id:"spel\u6743\u9650\u8868\u8fbe\u5f0f",level:2},{value:"\u5e38\u7528\u6743\u9650\u8868\u8fbe\u5f0f",id:"\u5e38\u7528\u6743\u9650\u8868\u8fbe\u5f0f",level:3},{value:"permitALL()\u6743\u9650\u793a\u4f8b",id:"permitall\u6743\u9650\u793a\u4f8b",level:4},{value:"Method\u8868\u8fbe\u5f0f\u5b89\u5168\u63a7\u5236",id:"method\u8868\u8fbe\u5f0f\u5b89\u5168\u63a7\u5236",level:3},{value:"RememberMe \u8bb0\u4f4f\u6211",id:"rememberme-\u8bb0\u4f4f\u6211",level:2},{value:"\u57fa\u7840\u77e5\u8bc6",id:"\u57fa\u7840\u77e5\u8bc6",level:3},{value:"\u81ea\u5b9a\u4e49\u914d\u7f6e",id:"\u81ea\u5b9a\u4e49\u914d\u7f6e",level:3},{value:"\u6570\u636e\u5e93\u5b9e\u73b0",id:"\u6570\u636e\u5e93\u5b9e\u73b0",level:3},{value:"\u9000\u51fa\u767b\u5f55",id:"\u9000\u51fa\u767b\u5f55",level:2},{value:"\u6838\u5fc3\u914d\u7f6e",id:"\u6838\u5fc3\u914d\u7f6e",level:3},{value:"\u81ea\u5b9a\u4e49\u914d\u7f6e",id:"\u81ea\u5b9a\u4e49\u914d\u7f6e-1",level:3},{value:"\u914d\u7f6eLogoutSuccessHandler",id:"\u914d\u7f6elogoutsuccesshandler",level:3},{value:"\u56fe\u7247\u9a8c\u8bc1",id:"\u56fe\u7247\u9a8c\u8bc1",level:2},{value:"\u5f15\u5165Kaptcha",id:"\u5f15\u5165kaptcha",level:3},{value:"\u5f15\u5165\u914d\u7f6e",id:"\u5f15\u5165\u914d\u7f6e",level:3},{value:"\u9a8c\u8bc1\u7801\u5728Session\u4e2d\u7684\u751f\u6210",id:"\u9a8c\u8bc1\u7801\u5728session\u4e2d\u7684\u751f\u6210",level:3},{value:"\u521b\u5efa\u9a8c\u8bc1\u7801\u4fe1\u606f\u7c7b",id:"\u521b\u5efa\u9a8c\u8bc1\u7801\u4fe1\u606f\u7c7b",level:4},{value:"\u628a\u9a8c\u8bc1\u7801\u4f20\u5230Session\u524d\u7aef",id:"\u628a\u9a8c\u8bc1\u7801\u4f20\u5230session\u524d\u7aef",level:4},{value:"\u5b9e\u73b0\u540e\u7aef\u9a8c\u8bc1--\u9a8c\u8bc1\u7801",id:"\u5b9e\u73b0\u540e\u7aef\u9a8c\u8bc1--\u9a8c\u8bc1\u7801",level:4},{value:"\u524d\u540e\u7aef\u5206\u79bb\u7684\u5e94\u7528",id:"\u524d\u540e\u7aef\u5206\u79bb\u7684\u5e94\u7528",level:2},{value:"JWT\u5de5\u5177\u7c7b",id:"jwt\u5de5\u5177\u7c7b",level:3},{value:"JWT\u5de5\u5177\u7c7b\u6a21\u677f 1",id:"jwt\u5de5\u5177\u7c7b\u6a21\u677f-1",level:4},{value:"\u5f15\u5165JWT\u5de5\u5177\u5305",id:"\u5f15\u5165jwt\u5de5\u5177\u5305",level:5},{value:"JWT\u6a21\u677f\u5f15\u5165",id:"jwt\u6a21\u677f\u5f15\u5165",level:5},{value:"\u83b7\u53d6Token",id:"\u83b7\u53d6token",level:5},{value:"\u63a5\u53e3\u8bbf\u95ee\u9274\u6743\u8fc7\u6ee4\u5668",id:"\u63a5\u53e3\u8bbf\u95ee\u9274\u6743\u8fc7\u6ee4\u5668",level:5},{value:"\u914d\u7f6eCORS\u89e3\u51b3\u8de8\u7ad9\u8bbf\u95ee",id:"\u914d\u7f6ecors\u89e3\u51b3\u8de8\u7ad9\u8bbf\u95ee",level:3}],u={toc:p};function c(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#spring-security-%E5%9F%BA%E7%A1%80"},"Spring Security \u57fa\u7840"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#spring-security-%E5%AF%B9%E6%AF%94-shiro"},"Spring Security \u5bf9\u6bd4 Shiro"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#spring-security-%E6%A0%B8%E5%BF%83"},"Spring Security \u6838\u5fc3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%AF%B9%E6%AF%94shiro"},"\u5bf9\u6bd4shiro")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#http-basic%E8%AE%A4%E8%AF%81%E6%A8%A1%E5%BC%8F"},"Http Basic\u8ba4\u8bc1\u6a21\u5f0f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#http-basic%E4%B8%8D%E5%A4%9F%E5%AE%89%E5%85%A8%E7%9A%84%E5%8E%9F%E5%9B%A0"},"Http Basic\u4e0d\u591f\u5b89\u5168\u7684\u539f\u56e0"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#postman%E6%B5%8B%E8%AF%95"},"POSTMAN\u6d4b\u8bd5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#httpbasic%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8E%9F%E7%90%86%E8%AF%B4%E6%98%8E"},"HttpBasic\u6a21\u5f0f\u7684\u539f\u7406\u8bf4\u660e")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#hash%E7%AE%97%E6%B3%95"},"Hash\u7b97\u6cd5"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#passwordencoder-%E6%8E%A5%E5%8F%A3"},"PasswordEncoder \u63a5\u53e3"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E6%B5%8B%E8%AF%95"},"\u6d4b\u8bd5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E6%B5%8B%E8%AF%95%E7%BB%93%E8%AE%BA"},"\u6d4b\u8bd5\u7ed3\u8bba")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#formlogin%E7%99%BB%E5%BD%95%E6%A8%A1%E5%BC%8F"},"formLogin\u767b\u5f55\u6a21\u5f0f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E8%AE%A4%E8%AF%81%E5%88%9D%E4%BD%93%E9%AA%8C"},"\u8ba4\u8bc1\u521d\u4f53\u9a8c"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81%E5%8F%8A%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E7%9A%84%E6%8E%A7%E5%88%B6%E9%87%8D%E8%A6%81"},"\u767b\u5f55\u8ba4\u8bc1\u53ca\u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u7684\u63a7\u5236\u3010\u91cd\u8981\u3011")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A7%92%E8%89%B2"},"\u521b\u5efa\u81ea\u5b9a\u4e49\u89d2\u8272")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%BC%80%E6%94%BE%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"},"\u5f00\u653e\u9759\u6001\u8d44\u6e90")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"},"\u6e90\u7801\u89e3\u6790")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E7%99%BB%E5%BD%95%E5%A4%84%E7%90%86%E9%87%8D%E8%A6%81"},"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u767b\u5f55\u5904\u7406\u3010\u91cd\u8981\u3011"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%90%8E%E7%AB%AF%E5%A4%84%E7%90%86-json"},"\u540e\u7aef\u5904\u7406 [JSON]")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%89%8D%E7%AB%AF%E5%A4%84%E7%90%86"},"\u524d\u7aef\u5904\u7406")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#session%E4%BC%9A%E8%AF%9D%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E5%99%A8"},"Session\u4f1a\u8bdd\u5b89\u5168\u7ba1\u7406\u5668"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"},"\u57fa\u672c\u7528\u6cd5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E4%BB%A5%E4%B8%8B%E6%96%B9%E6%B3%95%E9%83%BD%E6%98%AF%E5%9C%A8httpsecurity%E6%96%B9%E6%B3%95%E4%B8%AD%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0-"},"\u4ee5\u4e0b\u65b9\u6cd5\u90fd\u662f\u5728HttpSecurity\u65b9\u6cd5\u4e2d\u548c\u914d\u7f6e\u4e2d\u5b9e\u73b0 \u2193")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#session%E8%B6%85%E6%97%B6"},"session\u8d85\u65f6")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#session%E4%BF%9D%E6%8A%A4"},"session\u4fdd\u62a4")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#cookie%E5%AE%89%E5%85%A8"},"cookie\u5b89\u5168")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%90%8C%E8%B4%A6%E5%8F%B7%E5%A4%9A%E7%AB%AF%E7%99%BB%E5%BD%95%E8%B8%A2%E4%B8%8B%E7%BA%BF"},"\u540c\u8d26\u53f7\u591a\u7aef\u767b\u5f55\u8e22\u4e0b\u7ebf")))))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#spring-security-%E8%BF%9B%E9%98%B6%E7%AF%87"},"Spring Security \u8fdb\u9636\u7bc7"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#rbac%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B"},"RBAC\u6743\u9650\u6a21\u578b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BDrbac%E6%95%B0%E6%8D%AE"},"\u52a8\u6001\u52a0\u8f7dRBAC\u6570\u636e"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%AE%9E%E7%8E%B0dao%E5%B1%82%E6%8E%A5%E5%8F%A3%E5%92%8Cservice%E6%8E%A5%E5%8F%A3"},"\u5b9e\u73b0Dao\u5c42\u63a5\u53e3\u548cService\u63a5\u53e3"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%AE%9E%E7%8E%B0dao%E5%B1%82"},"\u5b9e\u73b0Dao\u5c42")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%AE%9E%E7%8E%B0service%E5%B1%82"},"\u5b9e\u73b0Service\u5c42")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%AE%9E%E7%8E%B0%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE"},"\u5b9e\u73b0\u540e\u7684\u914d\u7f6e")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E8%B5%84%E6%BA%90%E9%89%B4%E6%9D%83%E8%A7%84%E5%88%99"},"\u8d44\u6e90\u9274\u6743\u89c4\u5219"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AArbac%E7%B1%BB"},"\u521b\u5efa\u4e00\u4e2aRBAC\u7c7b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E9%85%8D%E7%BD%AE%E7%B1%BB%E6%9B%B4%E6%8D%A2"},"\u914d\u7f6e\u7c7b\u66f4\u6362")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#spel%E6%9D%83%E9%99%90%E8%A1%A8%E8%BE%BE%E5%BC%8F"},"SPEL\u6743\u9650\u8868\u8fbe\u5f0f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%B8%B8%E7%94%A8%E6%9D%83%E9%99%90%E8%A1%A8%E8%BE%BE%E5%BC%8F"},"\u5e38\u7528\u6743\u9650\u8868\u8fbe\u5f0f"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#permitall%E6%9D%83%E9%99%90%E7%A4%BA%E4%BE%8B"},"permitALL()\u6743\u9650\u793a\u4f8b")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#method%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AE%89%E5%85%A8%E6%8E%A7%E5%88%B6"},"Method\u8868\u8fbe\u5f0f\u5b89\u5168\u63a7\u5236")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#rememberme-%E8%AE%B0%E4%BD%8F%E6%88%91"},"RememberMe \u8bb0\u4f4f\u6211"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"},"\u57fa\u7840\u77e5\u8bc6")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE"},"\u81ea\u5b9a\u4e49\u914d\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0"},"\u6570\u636e\u5e93\u5b9e\u73b0")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"},"\u9000\u51fa\u767b\u5f55"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE"},"\u6838\u5fc3\u914d\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE-1"},"\u81ea\u5b9a\u4e49\u914d\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E9%85%8D%E7%BD%AElogoutsuccesshandler"},"\u914d\u7f6eLogoutSuccessHandler")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81"},"\u56fe\u7247\u9a8c\u8bc1"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%BC%95%E5%85%A5kaptcha"},"\u5f15\u5165Kaptcha")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%BC%95%E5%85%A5%E9%85%8D%E7%BD%AE"},"\u5f15\u5165\u914d\u7f6e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E9%AA%8C%E8%AF%81%E7%A0%81%E5%9C%A8session%E4%B8%AD%E7%9A%84%E7%94%9F%E6%88%90"},"\u9a8c\u8bc1\u7801\u5728Session\u4e2d\u7684\u751f\u6210"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%88%9B%E5%BB%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E4%BF%A1%E6%81%AF%E7%B1%BB"},"\u521b\u5efa\u9a8c\u8bc1\u7801\u4fe1\u606f\u7c7b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E6%8A%8A%E9%AA%8C%E8%AF%81%E7%A0%81%E4%BC%A0%E5%88%B0session%E5%89%8D%E7%AB%AF"},"\u628a\u9a8c\u8bc1\u7801\u4f20\u5230Session\u524d\u7aef")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%AE%9E%E7%8E%B0%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81--%E9%AA%8C%E8%AF%81%E7%A0%81"},"\u5b9e\u73b0\u540e\u7aef\u9a8c\u8bc1--\u9a8c\u8bc1\u7801")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%9A%84%E5%BA%94%E7%94%A8"},"\u524d\u540e\u7aef\u5206\u79bb\u7684\u5e94\u7528"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#jwt%E5%B7%A5%E5%85%B7%E7%B1%BB"},"JWT\u5de5\u5177\u7c7b"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#jwt%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%A8%A1%E6%9D%BF-1"},"JWT\u5de5\u5177\u7c7b\u6a21\u677f 1"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E5%BC%95%E5%85%A5jwt%E5%B7%A5%E5%85%B7%E5%8C%85"},"\u5f15\u5165JWT\u5de5\u5177\u5305")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#jwt%E6%A8%A1%E6%9D%BF%E5%BC%95%E5%85%A5"},"JWT\u6a21\u677f\u5f15\u5165")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E8%8E%B7%E5%8F%96token"},"\u83b7\u53d6Token")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E6%8E%A5%E5%8F%A3%E8%AE%BF%E9%97%AE%E9%89%B4%E6%9D%83%E8%BF%87%E6%BB%A4%E5%99%A8"},"\u63a5\u53e3\u8bbf\u95ee\u9274\u6743\u8fc7\u6ee4\u5668")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#%E9%85%8D%E7%BD%AEcors%E8%A7%A3%E5%86%B3%E8%B7%A8%E7%AB%99%E8%AE%BF%E9%97%AE"},"\u914d\u7f6eCORS\u89e3\u51b3\u8de8\u7ad9\u8bbf\u95ee"))))))),(0,r.kt)("h1",{id:"spring-security-\u57fa\u7840"},"Spring Security \u57fa\u7840"),(0,r.kt)("h2",{id:"spring-security-\u5bf9\u6bd4-shiro"},"Spring Security \u5bf9\u6bd4 Shiro"),(0,r.kt)("h3",{id:"spring-security-\u6838\u5fc3"},"Spring Security \u6838\u5fc3"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Authentication\uff1a\u8eab\u4efd\u8ba4\u8bc1\uff0c\u7528\u6237\u767b\u5f55\u7684\u9a8c\u8bc1"),(0,r.kt)("li",{parentName:"ul"},"Authorization\uff1a\u8bbf\u95ee\u6388\u6743\uff0c\u6388\u6743\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650"),(0,r.kt)("li",{parentName:"ul"},"\u5b89\u5168\u9632\u62a4\uff0c\u9632\u6b62\u8de8\u7ad9\u8bf7\u6c42\uff0csession\u653b\u51fb\u7b49")),(0,r.kt)("h3",{id:"\u5bf9\u6bd4shiro"},"\u5bf9\u6bd4shiro"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Spring Security\u5bf9OAuth\u652f\u6301\u66f4\u53cb\u597d"),(0,r.kt)("li",{parentName:"ul"},"Spring Security\u5728\u7f51\u7edc\u5b89\u5168\u65b9\u9762\u66f4\u597d"),(0,r.kt)("li",{parentName:"ul"},"\u901a\u5e38\u6765\u8bf4\uff0cshiro\u5165\u95e8\u66f4\u52a0\u5bb9\u6613\uff0c\u4f7f\u7528\u8d77\u6765\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u4e5f\u662f\u9020\u6210shiro\u7684\u4f7f\u7528\u91cf\u4e00\u76f4\u9ad8\u4e8eSpring Security\u7684\u4e3b\u8981\u539f\u56e0")),(0,r.kt)("h2",{id:"http-basic\u8ba4\u8bc1\u6a21\u5f0f"},"Http Basic\u8ba4\u8bc1\u6a21\u5f0f"),(0,r.kt)("p",null,"HttpBasic\u767b\u5f55\u9a8c\u8bc1\u6a21\u5f0f\u662fSpring Security\u5b9e\u73b0\u767b\u5f55\u9a8c\u8bc1\u6700\u7b80\u5355\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u662f\u6700\u7b80\u964b\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u5b83\u7684\u76ee\u7684\u5e76\u4e0d\u662f\u4fdd\u969c\u767b\u5f55\u9a8c\u8bc1\u7684\u7edd\u5bf9\u5b89\u5168\uff0c\u800c\u662f\u63d0\u4f9b\u4e00\u79cd\u201c\u9632\u541b\u5b50\u4e0d\u9632\u5c0f\u4eba\u201d\u7684\u767b\u5f55\u9a8c\u8bc1\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5982\u679c\u4f7f\u7528\u7684Spring Boot\u7248\u672c\u4e3a1.X\u7248\u672c,\u4f9d\u8d56\u7684Security 4.X\u7248\u672c\uff0c\u90a3\u4e48\u5c31\u65e0\u9700\u4efb\u4f55\u914d\u7f6e\uff0c\u542f\u52a8\u9879\u76ee\u8bbf\u95ee\u5219\u4f1a\u5f39\u51fa\u9ed8\u8ba4\u7684httpbasic\u8ba4\u8bc1.")),(0,r.kt)("p",null,"\u6211\u4eec\u73b0\u5728\u4f7f\u7528\u7684\u662fspring boot2.0\u7248\u672c\uff08\u4f9d\u8d56Security 5.X\u7248\u672c\uff09\uff0cHttpBasic\u4e0d\u518d\u662f\u9ed8\u8ba4\u7684\u9a8c\u8bc1\u6a21\u5f0f\uff0c\u5728spring security 5.x\u9ed8\u8ba4\u7684\u9a8c\u8bc1\u6a21\u5f0f\u5df2\u7ecf\u662f\u8868\u5355\u6a21\u5f0f\u3002\u6240\u4ee5\u6211\u4eec\u8981\u4f7f\u7528Basic\u6a21\u5f0f\uff0c\u9700\u8981\u81ea\u5df1\u8c03\u6574\u4e00\u4e0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class SecurityConfig  extends WebSecurityConfigurerAdapter {\n\n    @Override\n    protected void configure (HttpSecurity http) throws Exception {\n        http.httpBasic()// \u5f00\u542fhttpbasic\u8ba4\u8bc1\n            .and()\n            .authorizeRequests()\n            .anyRequest()\n            .authenticated();// \u6240\u6709\u8bf7\u6c42\u90fd\u9700\u8981\u767b\u5f55\u8ba4\u8bc1\u624d\u80fd\u8bbf\u95ee\n    }\n}\n")),(0,r.kt)("p",null,"Spring Boot\u542f\u52a8\u540e\u4f1a\u51fa\u73b0\u5bc6\u7801\uff0c\u8d26\u53f7\u9ed8\u8ba4\uff1auser"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Using generated security password: 33ff7198-ce12-4fd4-a24a-0cea0965959d")),(0,r.kt)("p",null,"\u5982\u679c\u8981\u81ea\u5b9a\u4e49\u7528\u6237\u3001\u5bc6\u7801\uff0c\u5fc5\u987b\u5728yaml\u4e2d\u914d\u7f6e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"spring:\n    security:\n      user:\n        name: admin\n        password: admin\n")),(0,r.kt)("h3",{id:"http-basic\u4e0d\u591f\u5b89\u5168\u7684\u539f\u56e0"},"Http Basic\u4e0d\u591f\u5b89\u5168\u7684\u539f\u56e0"),(0,r.kt)("h4",{id:"postman\u6d4b\u8bd5"},"POSTMAN\u6d4b\u8bd5"),(0,r.kt)("p",null,"\u767b\u5f55\u8ba4\u8bc1\u540e\uff0c\u5728Header\u4e2dAuthorization\u5bf9\u5e94\u7684\u503c\u6709Basic YWRtaW46YWRtaW4="),(0,r.kt)("p",null,"\u5176\u4e2dYWRtaW46YWRtaW4=\u901a\u8fc7Base64\u89e3\u5bc6\u540e\u53ef\u4ee5\u770b\u51fa"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(74489).Z,width:"519",height:"445"})),(0,r.kt)("h4",{id:"httpbasic\u6a21\u5f0f\u7684\u539f\u7406\u8bf4\u660e"},"HttpBasic\u6a21\u5f0f\u7684\u539f\u7406\u8bf4\u660e"),(0,r.kt)("p",null,"![](./img/httpbasic mode.png)"),(0,r.kt)("h2",{id:"hash\u7b97\u6cd5"},"Hash\u7b97\u6cd5"),(0,r.kt)("p",null,"Hash\u7b97\u6cd5\u7279\u522b\u7684\u5730\u65b9\u5728\u4e8e\u5b83\u662f\u4e00\u79cd\u5355\u5411\u7b97\u6cd5\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7hash\u7b97\u6cd5\u5bf9\u67d0\u4e2a\u6570\u636e\u751f\u6210\u4e00\u6bb5\u7279\u5b9a\u957f\u5ea6\u7684\u552f\u4e00hash\u503c\uff0c\u5374\u4e0d\u80fd\u901a\u8fc7\u8fd9\u4e2ahash\u503c\u9006\u5411\u83b7\u53d6\u539f\u59cb\u6570\u636e\u3002\u56e0\u6b64Hash\u7b97\u6cd5\u5e38\u7528\u5728\u4e0d\u53ef\u8fd8\u539f\u7684\u5bc6\u7801\u5b58\u50a8\u3001\u6570\u636e\u5b8c\u6574\u6027\u6821\u9a8c\u7b49\u9886\u57df\u3002"),(0,r.kt)("h3",{id:"passwordencoder-\u63a5\u53e3"},"PasswordEncoder \u63a5\u53e3"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"package org.springframework.security.crypto.password;\n\npublic interface PasswordEncoder {\n    String encode(CharSequence rawPassword);\n\n    boolean matches(CharSequence rawPassword, String encodedPassword);\n\n    default boolean upgradeEncoding(String encodedPassword) {\n        return false;\n    }\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"encode \u52a0\u5bc6\u5bc6\u7801\uff0chash\u503c\u662f\u4e0d\u80fd\u88ab\u9006\u5411\u89e3\u5bc6\u7684\u3002"),(0,r.kt)("li",{parentName:"ul"},"matches \u7528\u6765\u6821\u9a8c\u7528\u6237\u8f93\u5165\u5bc6\u7801rawPassword\uff0c\u548c\u52a0\u5bc6\u540e\u7684hash\u503cencodedPassword\u662f\u5426\u5339\u914d\u3002"),(0,r.kt)("li",{parentName:"ul"},"upgradeEncoding \u5224\u65ad\u5f53\u524d\u7684\u5bc6\u7801\u662f\u5426\u9700\u8981\u5347\u7ea7\u3002\u4e5f\u5c31\u662f\u662f\u5426\u9700\u8981\u91cd\u65b0\u52a0\u5bc6\uff1f\u9700\u8981\u7684\u8bdd\u8fd4\u56detrue\uff0c\u4e0d\u9700\u8981\u7684\u8bdd\u8fd4\u56defasle\u3002\u9ed8\u8ba4\u5b9e\u73b0\u662f\u8fd4\u56defalse\u3002")),(0,r.kt)("h4",{id:"\u6d4b\u8bd5"},"\u6d4b\u8bd5"),(0,r.kt)("p",null,"\u6d4b\u8bd5\u4ee3\u7801\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Test\nvoid bCryptPasswordTetst(){\n    PasswordEncoder passwordEncoder =  new BCryptPasswordEncoder();\n    String rawPassword = "123456";  //\u539f\u59cb\u5bc6\u7801\n    String encodedPassword = passwordEncoder.encode(rawPassword); //\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\n\n    System.out.println("\u539f\u59cb\u5bc6\u7801" + rawPassword);\n    System.out.println("\u52a0\u5bc6\u4e4b\u540e\u7684hash\u5bc6\u7801:" + encodedPassword);\n\n    System.out.println(rawPassword + "\u662f\u5426\u5339\u914d" + encodedPassword + ":"   //\u5bc6\u7801\u6821\u9a8c\uff1atrue\n                       + passwordEncoder.matches(rawPassword, encodedPassword));\n\n    System.out.println("654321\u662f\u5426\u5339\u914d" + encodedPassword + ":"   //\u5b9a\u4e49\u4e00\u4e2a\u9519\u8bef\u7684\u5bc6\u7801\u8fdb\u884c\u6821\u9a8c:false\n                       + passwordEncoder.matches("654321", encodedPassword));\n}\n')),(0,r.kt)("p",null,"\u7b2c\u4e00\u6b21\u6d4b\u8bd5\u7684\u7ed3\u679c\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u539f\u59cb\u5bc6\u7801123456\n\u52a0\u5bc6\u4e4b\u540e\u7684hash\u5bc6\u7801:$2a$10$xgd6LM8FfwgghM.4KLacIugcVxqY5hvvfuTgg9tXZxseiBGBc4GEi\n123456\u662f\u5426\u5339\u914d$2a$10$xgd6LM8FfwgghM.4KLacIugcVxqY5hvvfuTgg9tXZxseiBGBc4GEi:true\n654321\u662f\u5426\u5339\u914d$2a$10$xgd6LM8FfwgghM.4KLacIugcVxqY5hvvfuTgg9tXZxseiBGBc4GEi:false")),(0,r.kt)("p",null,"\u7b2c\u4e8c\u6b21\u6d4b\u8bd5\u7ed3\u679c\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u539f\u59cb\u5bc6\u7801123456\n\u52a0\u5bc6\u4e4b\u540e\u7684hash\u5bc6\u7801:$2a$10$HfB1IINOH2AG6bCbJ67h0OHBkeb.hL/1nwc84rnjTeAG6mXJWXo3m\n123456\u662f\u5426\u5339\u914d$2a$10$HfB1IINOH2AG6bCbJ67h0OHBkeb.hL/1nwc84rnjTeAG6mXJWXo3m:true\n654321\u662f\u5426\u5339\u914d$2a$10$HfB1IINOH2AG6bCbJ67h0OHBkeb.hL/1nwc84rnjTeAG6mXJWXo3m:false")),(0,r.kt)("h4",{id:"\u6d4b\u8bd5\u7ed3\u8bba"},"\u6d4b\u8bd5\u7ed3\u8bba"),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u51fa",(0,r.kt)("strong",{parentName:"p"},"\u5bf9\u4e8e\u540c\u4e00\u4e2a\u539f\u59cb\u5bc6\u7801\uff0c\u6bcf\u6b21\u52a0\u5bc6\u4e4b\u540e\u7684hash\u5bc6\u7801\u90fd\u662f\u4e0d\u4e00\u6837\u7684"),"\uff0c\u8fd9\u662f\u56e0\u4e3a",(0,r.kt)("strong",{parentName:"p"},"BCrypt\u4ea7\u751f\u968f\u673a\u76d0"),"\uff08\u76d0\u7684\u4f5c\u7528\u5c31\u662f\u6bcf\u6b21\u505a\u51fa\u6765\u7684\u83dc\u5473\u9053\u90fd\u4e0d\u4e00\u6837\uff09"),(0,r.kt)("p",null,"BCrypt\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\u6709\u4e09\u4e2a\u90e8\u5206\uff0c\u7531 $\u5206\u9694\uff1a\uff08\u517160\u4f4d\uff09"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'"2a"\u8868\u793a BCrypt \u7b97\u6cd5\u7248\u672c'),(0,r.kt)("li",{parentName:"ol"},'"10"\u8868\u793a\u7b97\u6cd5\u7684\u5f3a\u5ea6'),(0,r.kt)("li",{parentName:"ol"},'"zt6dUMTjNSyzINTGyiAglu"\u90e8\u5206\u5b9e\u9645\u4e0a\u662f\u968f\u673a\u751f\u6210\u7684\u76d0\u3002\u901a\u5e38\u6765\u8bf4\u524d 22 \u4e2a\u5b57\u7b26\u662f\u76d0\uff0c\u5269\u4f59\u90e8\u5206\u662f\u7eaf\u6587\u672c\u7684\u5b9e\u9645\u54c8\u5e0c\u503c')),(0,r.kt)("h2",{id:"formlogin\u767b\u5f55\u6a21\u5f0f"},"formLogin\u767b\u5f55\u6a21\u5f0f"),(0,r.kt)("p",null,"Spring Security\u7684\u767b\u5f55\u8ba4\u8bc1\u5e76\u4e0d\u9700\u8981\u6211\u4eec\u81ea\u5df1\u53bb\u5199\u767b\u5f55\u8ba4\u8bc1\u7684Controller\u65b9\u6cd5\uff0c\u800c\u662f\u4f7f\u7528\u8fc7\u6ee4\u5668UsernamePasswordAuthenticationFilter\u3002"),(0,r.kt)("h3",{id:"\u8ba4\u8bc1\u521d\u4f53\u9a8c"},"\u8ba4\u8bc1\u521d\u4f53\u9a8c"),(0,r.kt)("h4",{id:"\u767b\u5f55\u8ba4\u8bc1\u53ca\u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u7684\u63a7\u5236\u91cd\u8981"},"\u767b\u5f55\u8ba4\u8bc1\u53ca\u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u7684\u63a7\u5236\u3010\u91cd\u8981\u3011"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u7ee7\u627f",(0,r.kt)("strong",{parentName:"li"},"WebSecurityConfigurerAdapter")),(0,r.kt)("li",{parentName:"ol"},"\u91cd\u5199configure (HttpSecurity http)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Override\nprotected void configure (HttpSecurity http) throws Exception {\n    http.csrf().disable()// \u7981\u7528\u8de8\u7ad9csrf\u653b\u51fb\u9632\u5fa1\n        .formLogin()\n            .loginPage("/login.html") // \u4e00\u65e6\u7528\u6237\u7684\u8bf7\u6c42\u6ca1\u6709\u6743\u9650\u5c31\u8df3\u8f6c\u5230\u8fd9\u4e2a\u9875\u9762\n            .loginProcessingUrl("/login") // \u767b\u5f55\u8868\u5355form\u4e2daction\u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u5904\u7406\u8ba4\u8bc1\u8bf7\u6c42\u7684\u8def\u5f84\n            .usernameParameter("username") // \u767b\u5f55\u8868\u5355form\u4e2d\u7528\u6237\u540d\u8f93\u5165\u6846input\u7684name\u540d\uff0c\u4e0d\u4fee\u6539\u7684\u8bdd\u9ed8\u8ba4\u662fusername\n            .passwordParameter("password") // form\u4e2d\u5bc6\u7801\u8f93\u5165\u6846input\u7684name\u540d\uff0c\u4e0d\u4fee\u6539\u7684\u8bdd\u9ed8\u8ba4\u662fpassword\n            .defaultSuccessUrl("/") // \u767b\u5f55\u8ba4\u8bc1\u6210\u529f\u540e\u9ed8\u8ba4\u8f6c\u8df3\u7684\u8def\u5f84\n        .and()\n            .authorizeRequests()\n            .antMatchers("/login.html","/login").permitAll()// \u4e0d\u9700\u8981\u901a\u8fc7\u767b\u5f55\u9a8c\u8bc1\u5c31\u53ef\u4ee5\u88ab\u8bbf\u95ee\u7684\u8d44\u6e90\u8def\u5f84\n            .antMatchers("/","/biz1","/biz2") // \u8d44\u6e90\u8def\u5f84\u5339\u914d\n                .hasAnyAuthority("ROLE_user","ROLE_admin")  // user\u89d2\u8272\u548cadmin\u89d2\u8272\u90fd\u53ef\u4ee5\u8bbf\u95ee\n        //                    .antMatchers("/syslog","/sysuser")  // \u8d44\u6e90\u8def\u5f84\u5339\u914d\n        //                        .hasAnyRole("admin")  // admin\u89d2\u8272\u53ef\u4ee5\u8bbf\u95ee\n            .antMatchers("/syslog").hasAuthority("sys:log")\n            .antMatchers("/sysuser").hasAuthority("sys:user")\n        .anyRequest()\n        .authenticated();// \u6240\u6709\u8bf7\u6c42\u90fd\u9700\u8981\u767b\u5f55\u8ba4\u8bc1\u624d\u80fd\u8bbf\u95ee\n}\n')),(0,r.kt)("p",null,"\u903b\u8f91\u5c0f\u7ed3\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u9996\u5148\u5173\u95ed\u8de8\u7ad9\u653b\u51fb\u9632\u5fa1\uff08",(0,r.kt)("em",{parentName:"li"},"scrf"),"\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528.",(0,r.kt)("em",{parentName:"li"},"formLogin"),"() \u5f00\u542f\u6a21\u5f0f"),(0,r.kt)("li",{parentName:"ul"},"\u914d\u7f6e\u767b\u5f55\u9875\u3001\u524d\u7aef\u4f20\u5165\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u3001\u6210\u529f\u540e\u8df3\u8f6c"),(0,r.kt)("li",{parentName:"ul"},"\u7136\u540e\uff08",(0,r.kt)("em",{parentName:"li"},"and"),"\uff09\u5f00\u59cb\u8ba4\u8bc1\uff08",(0,r.kt)("em",{parentName:"li"},"authorizeRequests"),"\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u6dfb\u52a0\u8ba4\u8bc1\u7684\u8df3\u8f6c\u5730\u5740\uff08",(0,r.kt)("em",{parentName:"li"},"antMatchers"),"\uff09\u548c\u8df3\u8f6c\u8be5\u5730\u5740\u9700\u8981\u7684\u6743\u9650\uff08",(0,r.kt)("em",{parentName:"li"},"permitAll"),"\u3001",(0,r.kt)("em",{parentName:"li"},"hasAuthority"),"\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u6700\u540e\u52a0\u4e0a\u4efb\u4f55\u8bf7\u6c42\uff08",(0,r.kt)("em",{parentName:"li"},"anyRequest"),"\uff09\u548c\u8ba4\u8bc1\u624d\u80fd\u8bbf\u95ee\uff08",(0,r.kt)("em",{parentName:"li"},"authenticated"),"\uff09")),(0,r.kt)("h4",{id:"\u521b\u5efa\u81ea\u5b9a\u4e49\u89d2\u8272"},"\u521b\u5efa\u81ea\u5b9a\u4e49\u89d2\u8272"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic void configure(AuthenticationManagerBuilder auth) throws Exception {\n    auth.inMemoryAuthentication()\n        .withUser("user")\n        .password(passwordEncoder().encode("123456"))\n        .roles("user")\n        .and()\n        .withUser("admin")\n        .password(passwordEncoder().encode("123456"))\n        .authorities("sys:log","sys:user")\n        //.roles("admin")\n        .and()\n        .passwordEncoder(passwordEncoder());//\u914d\u7f6eBCrypt\u52a0\u5bc6\n}\n\n@Bean\npublic PasswordEncoder passwordEncoder(){\n    return new BCryptPasswordEncoder();\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"inMemoryAuthentication"),"\u6307\u7684\u662f\u5728\u5185\u5b58\u91cc\u9762\u5b58\u50a8\u7528\u6237\u7684\u8eab\u4efd\u8ba4\u8bc1\u548c\u6388\u6743\u4fe1\u606f\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'withUser("user")'),"\u7528\u6237\u540d\u662fuser"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'password(passwordEncoder().encode("123456"))'),"\u5bc6\u7801\u662f\u52a0\u5bc6\u4e4b\u540e\u7684123456"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'authorities("sys:log","sys:user")'),'\u6307\u7684\u662fadmin\u7528\u6237\u62e5\u6709\u8d44\u6e90ID\u5bf9\u5e94\u7684\u8d44\u6e90\u8bbf\u95ee\u7684\u7684\u6743\u9650\uff1a"/syslog"\u548c"/sysuser"'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"roles()"),"\u65b9\u6cd5\u7528\u4e8e\u6307\u5b9a\u7528\u6237\u7684\u89d2\u8272\uff0c\u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u6709\u591a\u4e2a\u89d2\u8272")),(0,r.kt)("h4",{id:"\u5f00\u653e\u9759\u6001\u8d44\u6e90"},"\u5f00\u653e\u9759\u6001\u8d44\u6e90"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic void configure(WebSecurity web) {\n    web.ignoring().antMatchers("/css/**", "/font/**", "/img/**", "/js/**");\n}\n')),(0,r.kt)("h3",{id:"\u6e90\u7801\u89e3\u6790"},"\u6e90\u7801\u89e3\u6790"),(0,r.kt)("p",null,"\u767b\u5f55\u8ba4\u8bc1\u7684\u6267\u884c\u6d41\u7a0b"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(67514).Z,width:"1409",height:"389"})),(0,r.kt)("p",null,"\u767b\u5f55\u8ba4\u8bc1\u7684\u7ec6\u8282"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(51243).Z,width:"660",height:"441"})),(0,r.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u767b\u5f55\u5904\u7406\u91cd\u8981"},"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u767b\u5f55\u5904\u7406\u3010\u91cd\u8981\u3011"),(0,r.kt)("h4",{id:"\u540e\u7aef\u5904\u7406-json"},"\u540e\u7aef\u5904\u7406 ","[JSON]"),(0,r.kt)("p",null,"\u9884\u5148\u5b9a\u4e49\u4e00\u4e2a\u524d\u540e\u7aef\u5904\u7406\u7684JSON\u7c7b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package cn.zhiyucs.commons.exception;\n\nimport lombok.Data;\n\n@Data\npublic class AjaxResponse {\n    private boolean isok;  //\u8bf7\u6c42\u662f\u5426\u5904\u7406\u6210\u529f\n\n    private int code; //\u8bf7\u6c42\u54cd\u5e94\u72b6\u6001\u7801\uff08200\u3001400\u3001500\uff09\n\n    private String message;  //\u8bf7\u6c42\u7ed3\u679c\u63cf\u8ff0\u4fe1\u606f\n\n    private Object data; //\u8bf7\u6c42\u7ed3\u679c\u6570\u636e\uff08\u901a\u5e38\u7528\u4e8e\u67e5\u8be2\u64cd\u4f5c\uff09\n\n    private AjaxResponse(){}\n\n    public static AjaxResponse userInputError(String error) {\n        AjaxResponse resultBean = new AjaxResponse();\n        resultBean.setIsok(false);\n        resultBean.setCode(500);\n        resultBean.setMessage(error);\n        return resultBean;\n    }\n\n    //\u8bf7\u6c42\u51fa\u73b0\u5f02\u5e38\u65f6\u7684\u54cd\u5e94\u6570\u636e\u5c01\u88c5\n    public static AjaxResponse error(CustomException e) {\n        AjaxResponse resultBean = new AjaxResponse();\n        resultBean.setIsok(false);\n        resultBean.setCode(e.getCode());\n        resultBean.setMessage(e.getMessage());\n        return resultBean;\n    }\n\n    //\u8bf7\u6c42\u51fa\u73b0\u5f02\u5e38\u65f6\u7684\u54cd\u5e94\u6570\u636e\u5c01\u88c5\n    public static AjaxResponse error(CustomExceptionType customExceptionType,\n                                     String errorMessage) {\n        AjaxResponse resultBean = new AjaxResponse();\n        resultBean.setIsok(false);\n        resultBean.setCode(customExceptionType.getCode());\n        resultBean.setMessage(errorMessage);\n        return resultBean;\n    }\n\n    //\u8bf7\u6c42\u6210\u529f\u7684\u54cd\u5e94\uff0c\u4e0d\u5e26\u67e5\u8be2\u6570\u636e\uff08\u7528\u4e8e\u5220\u9664\u3001\u4fee\u6539\u3001\u65b0\u589e\u63a5\u53e3\uff09\n    public static AjaxResponse success(){\n        AjaxResponse ajaxResponse = new AjaxResponse();\n        ajaxResponse.setIsok(true);\n        ajaxResponse.setCode(200);\n        ajaxResponse.setMessage("\u8bf7\u6c42\u54cd\u5e94\u6210\u529f!");\n        return ajaxResponse;\n    }\n\n    //\u8bf7\u6c42\u6210\u529f\u7684\u54cd\u5e94\uff0c\u5e26\u6709\u67e5\u8be2\u6570\u636e\uff08\u7528\u4e8e\u6570\u636e\u67e5\u8be2\u63a5\u53e3\uff09\n    public static AjaxResponse success(Object obj){\n        AjaxResponse ajaxResponse = new AjaxResponse();\n        ajaxResponse.setIsok(true);\n        ajaxResponse.setCode(200);\n        ajaxResponse.setMessage("\u8bf7\u6c42\u54cd\u5e94\u6210\u529f!");\n        ajaxResponse.setData(obj);\n        return ajaxResponse;\n    }\n\n    //\u8bf7\u6c42\u6210\u529f\u7684\u54cd\u5e94\uff0c\u5e26\u6709\u67e5\u8be2\u6570\u636e\uff08\u7528\u4e8e\u6570\u636e\u67e5\u8be2\u63a5\u53e3\uff09\n    public static AjaxResponse success(Object obj,String message){\n        AjaxResponse ajaxResponse = new AjaxResponse();\n        ajaxResponse.setIsok(true);\n        ajaxResponse.setCode(200);\n        ajaxResponse.setMessage(message);\n        ajaxResponse.setData(obj);\n        return ajaxResponse;\n    }\n}\n')),(0,r.kt)("p",null,"\u7ee7\u627f\u8df3\u8f6c\u6210\u529f\u5904\u7406\u548c\u5931\u8d25\u5904\u7406"),(0,r.kt)("p",null,"\u6210\u529f\u5904\u7406\uff0c\u4ee5\u4e0b\u4e3a\u4ee3\u7801\u548c\u6ce8\u610f\u4e8b\u9879\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8bb0\u5f97@Component"),(0,r.kt)("li",{parentName:"ul"},"\u7ee7\u627f\u7684\u662fSavedRequestAwareAuthenticationSuccessHandler"),(0,r.kt)("li",{parentName:"ul"},"ObjectMapper\u662fSpring Boot\u9ed8\u8ba4\u96c6\u6210\u7684JSON\u6570\u636e\u5904\u7406\u7c7b\u5e93Jackson\u4e2d\u7684\u7c7b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class MyAuthenticationSuccessHandler\n    extends SavedRequestAwareAuthenticationSuccessHandler {\n\n    @Value("${spring.security.logintype}")\n    private String loginType;\n\n    private static ObjectMapper objectMapper = new ObjectMapper();\n\n    @Override\n    public void onAuthenticationSuccess(HttpServletRequest request,\n                                        HttpServletResponse response,\n                                        Authentication authentication) throws IOException, ServletException {\n        if (loginType.equalsIgnoreCase("JSON")) {\n            response.setContentType("application/json;charset=UTF-8");\n            response.getWriter().write(objectMapper.writeValueAsString(\n                AjaxResponse.success()\n            ));\n        } else {\n            // \u4f1a\u5e2e\u6211\u4eec\u8df3\u8f6c\u5230\u4e0a\u4e00\u6b21\u8bf7\u6c42\u7684\u9875\u9762\u4e0a\n            super.onAuthenticationSuccess(request, response, authentication);\n        }\n    }\n}\n')),(0,r.kt)("p",null,"\u5931\u8d25\u5904\u7406\u540c\u7406\uff0c\u7ee7\u627f\uff08SimpleUrlAuthenticationFailureHandler\uff09\u3002"),(0,r.kt)("p",null,"\u5728Spring Security\u4e2d\u4fee\u6539\u9ed8\u8ba4\u7684\u8df3\u8f6c\u9875\u4e3a\u81ea\u5b9a\u4e49\u7684\u8df3\u8f6c\u9875\u5373\u53ef\uff08",(0,r.kt)("em",{parentName:"p"},"successHandler"),"\u3001",(0,r.kt)("em",{parentName:"p"},"failureHandler"),"\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'http.csrf().disable()// \u7981\u7528\u8de8\u7ad9csrf\u653b\u51fb\u9632\u5fa1\n    .formLogin()\n        .loginPage("/login.html") // \u4e00\u65e6\u7528\u6237\u7684\u8bf7\u6c42\u6ca1\u6709\u6743\u9650\u5c31\u8df3\u8f6c\u5230\u8fd9\u4e2a\u9875\u9762\n        .loginProcessingUrl("/login") // \u767b\u5f55\u8868\u5355form\u4e2daction\u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u5904\u7406\u8ba4\u8bc1\u8bf7\u6c42\u7684\u8def\u5f84\n        .usernameParameter("username") // \u767b\u5f55\u8868\u5355form\u4e2d\u7528\u6237\u540d\u8f93\u5165\u6846input\u7684name\u540d\uff0c\u4e0d\u4fee\u6539\u7684\u8bdd\u9ed8\u8ba4\u662fusername\n        .passwordParameter("password") // form\u4e2d\u5bc6\u7801\u8f93\u5165\u6846input\u7684name\u540d\uff0c\u4e0d\u4fee\u6539\u7684\u8bdd\u9ed8\u8ba4\u662fpassword\n    //                    .defaultSuccessUrl("/") // \u767b\u5f55\u8ba4\u8bc1\u6210\u529f\u540e\u9ed8\u8ba4\u8f6c\u8df3\u7684\u8def\u5f84\n        .successHandler(mySuccessHandler)\n        .failureHandler(myFailureHandler)\n')),(0,r.kt)("h4",{id:"\u524d\u7aef\u5904\u7406"},"\u524d\u7aef\u5904\u7406"),(0,r.kt)("p",null,"\u524d\u7aef\u4f7f\u7528Ajax\u53d1\u9001\u767b\u5f55\u5373\u53ef\uff0c\u6ce8\u610f\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<input type="button" onclick="login()" value="\u767b\u9646">\n'))),(0,r.kt)("p",null,'\u4e0d\u662ftype="submit"\u800c\u662fbutton\uff0c\u4e0d\u7136\u63a5\u6536\u5230\u7684\u5c31\u662f\u4e00\u4e32JSON\uff08Vue\u6846\u67b6\u5ffd\u7565\uff09'),(0,r.kt)("p",null,"\u7136\u540e\u5c31\u53ef\u4ee5\u53d1\u8d77AJAX\u8bf7\u6c42\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"$.ajax({\n    type: 'POST',\n    url: '/login',\n    data: {\n        username,\n        password\n    },\n    success(resp) {\n        ....\n    },\n    error(e) {\n        ...\n    }\n});\n")),(0,r.kt)("h3",{id:"session\u4f1a\u8bdd\u5b89\u5168\u7ba1\u7406\u5668"},"Session\u4f1a\u8bdd\u5b89\u5168\u7ba1\u7406\u5668"),(0,r.kt)("h4",{id:"\u57fa\u672c\u7528\u6cd5"},"\u57fa\u672c\u7528\u6cd5"),(0,r.kt)("p",null,"Spring Security\u63d0\u4f9b4\u79cd\u65b9\u5f0f\u7cbe\u786e\u7684\u63a7\u5236\u4f1a\u8bdd\u7684\u521b\u5efa\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"always"),"\uff1a\u5982\u679c\u5f53\u524d\u8bf7\u6c42\u6ca1\u6709\u5bf9\u5e94\u7684session\u5b58\u5728\uff0cSpring Security\u521b\u5efa\u4e00\u4e2asession\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ifRequired\uff08\u9ed8\u8ba4\uff09"),"\uff1a Spring Security\u5728\u9700\u8981\u4f7f\u7528\u5230session\u65f6\u624d\u521b\u5efasession"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"never"),"\uff1a Spring Security\u5c06\u6c38\u8fdc\u4e0d\u4f1a\u4e3b\u52a8\u521b\u5efasession\uff0c\u4f46\u662f\u5982\u679csession\u5728\u5f53\u524d\u5e94\u7528\u4e2d\u5df2\u7ecf\u5b58\u5728\uff0c\u5b83\u5c06\u4f7f\u7528\u8be5session"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"stateless"),"\uff1aSpring Security\u4e0d\u4f1a\u521b\u5efa\u6216\u4f7f\u7528\u4efb\u4f55session\u3002\u9002\u5408\u4e8e\u63a5\u53e3\u578b\u7684\u65e0\u72b6\u6001\u5e94\u7528\uff08\u524d\u540e\u7aef\u5206\u79bb\u65e0\u72b6\u6001\u5e94\u7528\uff09\uff0c\u8fd9\u79cd\u65b9\u5f0f\u8282\u7701\u5185\u5b58\u8d44\u6e90")),(0,r.kt)("p",null,"\u4e00\u822c\u4e0d\u5efa\u8bae\u4fee\u6539\uff0c\u5982\u679c\u975e\u8981\u4fee\u6539session\uff0c\u53ef\u4ee5\u5728",(0,r.kt)("strong",{parentName:"p"},"\u53c2\u6570\u4e3a\uff1aHttpSecurity \u51fd\u6570\u4e2d\u4fee\u6539"),"\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    .antMatchers("/syslog").hasAuthority("sys:log")\n                    .antMatchers("/sysuser").hasAuthority("sys:user")\n                .anyRequest()\n                .authenticated()// \u6240\u6709\u8bf7\u6c42\u90fd\u9700\u8981\u767b\u5f55\u8ba4\u8bc1\u624d\u80fd\u8bbf\u95ee\n                .and().sessionManagement()\n                       .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED);\n')),(0,r.kt)("h4",{id:"\u4ee5\u4e0b\u65b9\u6cd5\u90fd\u662f\u5728httpsecurity\u65b9\u6cd5\u4e2d\u548c\u914d\u7f6e\u4e2d\u5b9e\u73b0-"},"\u4ee5\u4e0b\u65b9\u6cd5\u90fd\u662f\u5728HttpSecurity\u65b9\u6cd5\u4e2d\u548c\u914d\u7f6e\u4e2d\u5b9e\u73b0 \u2193"),(0,r.kt)("h4",{id:"session\u8d85\u65f6"},"session\u8d85\u65f6"),(0,r.kt)("p",null,"\u5728Spring boot\u5e94\u7528\u4e2d\u6709\u4e24\u79cd\u8bbe\u7f6e\u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\u7684\u65b9\u5f0f\uff0cSpring Security\u5bf9\u8fd9\u4e24\u79cd\u65b9\u5f0f\u5b8c\u5168\u517c\u5bb9\uff0c\u5373\uff1a\u5f53\u4f1a\u8bdd\u8d85\u65f6\u4e4b\u540e\u7528\u6237\u9700\u8981\u91cd\u65b0\u767b\u5f55\u624d\u80fd\u8bbf\u95ee\u5e94\u7528\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"server.servlet.session.timeout=15m"),(0,r.kt)("li",{parentName:"ul"},"spring.session.timeout = 15m")),(0,r.kt)("p",null,"\u7b2c\u4e00\u79cd\u65b9\u5f0f\u662fspringBoot\u5e94\u7528\u81ea\u5e26\u7684session\u8d85\u65f6\u914d\u7f6e\uff0c\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u662f\u6211\u4eec\u4f7f\u7528Spring Session\u4e4b\u540e\uff0c\u63d0\u4f9b\u7684session\u8d85\u65f6\u914d\u7f6e\u3002\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002"),(0,r.kt)("p",null,"\u8d85\u65f6\u4f1a\u8bdd\u5904\u7406\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'http.sessionManagement()\n    .invalidSessionUrl("/invalidSession.html");    //\u975e\u6cd5\u8d85\u65f6session\u8df3\u8f6c\u9875\u9762\n')),(0,r.kt)("h4",{id:"session\u4fdd\u62a4"},"session\u4fdd\u62a4"),(0,r.kt)("p",null,"session-fixation-protection \u5373session\u7684\u56fa\u5316\u4fdd\u62a4\u529f\u80fd\uff0c\u8be5\u529f\u80fd\u7684\u76ee\u7684\u662f\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u9632\u6b62\u975e\u6cd5\u7528\u6237\u7a83\u53d6\u7528\u6237session\u53cacookies\u4fe1\u606f\uff0c\u8fdb\u800c\u6a21\u62dfsession\u7684\u884c\u4e3a\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"http.sessionManagement().sessionFixation().migrateSession()\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8bbe\u7f6e\u4e3a\u201c",(0,r.kt)("em",{parentName:"li"},"none"),"\u201d\u65f6\uff0c\u539f\u59cb\u4f1a\u8bdd\u4e0d\u4f1a\u65e0\u6548"),(0,r.kt)("li",{parentName:"ul"},"\u8bbe\u7f6e\u201c",(0,r.kt)("em",{parentName:"li"},"newSession"),"\u201d\u540e\uff0c\u5c06\u521b\u5efa\u4e00\u4e2a\u5e72\u51c0\u7684\u4f1a\u8bdd\uff0c\u800c\u4e0d\u4f1a\u590d\u5236\u65e7\u4f1a\u8bdd\u4e2d\u7684\u4efb\u4f55\u5c5e\u6027"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"migrateSession")," - \u5373\u5bf9\u4e8e\u540c\u4e00\u4e2acookies\u7684SESSIONID\u7528\u6237\uff0c\u6bcf\u6b21\u767b\u5f55\u8bbf\u95ee\u4e4b\u540e\u8bbf\u95ee\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u7684HTTP Session\u4f1a\u8bdd\uff0c\u65e7\u7684HTTP Session\u4f1a\u8bdd\u5c06\u65e0\u6548\uff0c\u5e76\u4e14\u65e7Session\u4f1a\u8bdd\u7684\u5c5e\u6027\u5c06\u88ab\u590d\u5236\u3002",(0,r.kt)("strong",{parentName:"li"},"\u5728Servlet 3.0\u53ca\u5176\u4e4b\u524d\u7684\u7248\u672c\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u9ed8\u8ba4\u7684")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"changeSessionId")," - \u8fd9\u79cd\u65b9\u5f0f\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684session\uff0c\u4f5c\u4e3a\u66ff\u4ee3\uff0c\u4f7f\u7528Servlet \u5bb9\u5668(",(0,r.kt)("inlineCode",{parentName:"li"},"HttpServletRequest#changeSessionId()"),")\u63d0\u4f9b\u7684\u4f1a\u8bdd\u56fa\u5316\u4fdd\u62a4\u529f\u80fd \u3002",(0,r.kt)("strong",{parentName:"li"},"\u8fd9\u4e2a\u9009\u9879\u5728Servlet 3.1 (Java EE 7) \u6216\u8005\u66f4\u65b0\u7248\u672c\u7684web\u5bb9\u5668\u4e0b\u9ed8\u8ba4\u751f\u6548\u3002")," \u6bcf\u6b21\u767b\u5f55\u8bbf\u95ee\u4e4b\u540e\u90fd\u66f4\u6362sessionid\uff0c\u4f46\u662f\u6ca1\u6709\u65b0\u5efasession\u4f1a\u8bdd\u3002")),(0,r.kt)("h4",{id:"cookie\u5b89\u5168"},"cookie\u5b89\u5168"),(0,r.kt)("p",null,"\u719f\u6089Session\u5b9e\u73b0\u539f\u7406\u7684\u670b\u53cb\u4e00\u5b9a\u90fd\u77e5\u9053\uff0c\u63d0\u9ad8Cookies\u7684\u5b89\u5168\u6027\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u63d0\u9ad8session\u7684\u5b89\u5168\u6027\u3002\u5728Spring Boot\u4e2d\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u65b9\u5f0f\u6765\u5b9e\u73b0\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"server.servlet.session.cookie.http-only=true\nserver.servlet.session.cookie.secure=true\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"httpOnly\uff1a\u5982\u679c\u4e3atrue\uff0c\u5219\u6d4f\u89c8\u5668\u811a\u672c\u5c06\u65e0\u6cd5\u8bbf\u95eecookie"),(0,r.kt)("li",{parentName:"ul"},"secure\uff1a\u5982\u679c\u4e3atrue\uff0c\u5219\u4ec5\u901a\u8fc7HTTPS\u8fde\u63a5\u53d1\u9001cookie\uff0cHTTP\u65e0\u6cd5\u643a\u5e26cookie")),(0,r.kt)("h4",{id:"\u540c\u8d26\u53f7\u591a\u7aef\u767b\u5f55\u8e22\u4e0b\u7ebf"},"\u540c\u8d26\u53f7\u591a\u7aef\u767b\u5f55\u8e22\u4e0b\u7ebf"),(0,r.kt)("p",null,"\u6838\u5fc3\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},".sessionManagement()\n    .maximumSessions(1)\n    .maxSessionsPreventsLogin(false)\n    .expiredSessionStrategy(new CustomExpiredSessionStrategy())\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"maximumSessions")," \u8868\u793a\u540c\u4e00\u4e2a\u7528\u6237\u6700\u5927\u7684\u767b\u5f55\u6570\u91cf"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"maxSessionsPreventsLogin")," \u63d0\u4f9b\u4e24\u79cdsession\u4fdd\u62a4\u7b56\u7565\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"true\u8868\u793a\u5df2\u7ecf\u767b\u5f55\u5c31\u4e0d\u4e88\u8bb8\u518d\u6b21\u767b\u5f55\uff0c"),(0,r.kt)("li",{parentName:"ul"},"false\u8868\u793a\u5141\u8bb8\u518d\u6b21\u767b\u5f55\u4f46\u662f\u4e4b\u524d\u7684\u767b\u5f55\u8d26\u6237\u4f1a\u88ab\u8e22\u4e0b\u7ebf"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"expiredSessionStrategy "),"\u8868\u793a\u81ea\u5b9a\u4e49\u4e00\u4e2asession\u88ab\u4e0b\u7ebf(\u8d85\u65f6)\u4e4b\u540e\u7684\u5904\u7406\u7b56\u7565\u3002")),(0,r.kt)("p",null,"\u5982\u679c\u4e0d\u4f7f\u7528\u524d\u540e\u7aef\u5206\u79bb\uff0c\u88ab\u8e22\u4e0b\u7ebf\u540e\u7684\u7b56\u7565\u53ef\u4ee5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class CustomExpiredSessionStrategy implements SessionInformationExpiredStrategy {\n\n    //\u9875\u9762\u8df3\u8f6c\u7684\u5904\u7406\u903b\u8f91\n    private RedirectStrategy redirectStrategy = new DefaultRedirectStrategy();\n\n    @Override\n    public void onExpiredSessionDetected(SessionInformationExpiredEvent event) throws IOException, ServletException {\n        // \u662f\u8df3\u8f6chtml\u9875\u9762\uff0curl\u4ee3\u8868\u8df3\u8f6c\u7684\u5730\u5740\n        redirectStrategy.sendRedirect(event.getRequest(), event.getResponse(), "\u67d0\u4e2aurl");\n    }\n}\n')),(0,r.kt)("p",null,"\u5982\u679c\u91c7\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684JSON\uff0c\u53ef\u4ee5\u4f7f\u7528\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'private static ObjectMapper objectMapper = new ObjectMapper();\n\n@Override\npublic void onExpiredSessionDetected(SessionInformationExpiredEvent event)\n    throws IOException, ServletException {\n    //        redirectStrategy.sendRedirect(event.getRequest(), event.getResponse(), "");\n    Map<String, Object> map = new HashMap<>();\n    map.put("code", 403);\n    map.put("msg", "\u60a8\u7684\u767b\u5f55\u5df2\u7ecf\u8d85\u65f6\u6216\u8005\u5df2\u7ecf\u5728\u53e6\u4e00\u53f0\u673a\u5668\u767b\u5f55\uff0c\u60a8\u88ab\u8feb\u4e0b\u7ebf\u3002"\n            + event.getSessionInformation().getLastRequest());\n\n    String json = objectMapper.writeValueAsString(map);\n\n    event.getResponse().setContentType("application/json;charset=UTF-8");\n    event.getResponse().getWriter().write(json);\n}\n')),(0,r.kt)("h1",{id:"spring-security-\u8fdb\u9636\u7bc7"},"Spring Security \u8fdb\u9636\u7bc7"),(0,r.kt)("h2",{id:"rbac\u6743\u9650\u6a21\u578b"},"RBAC\u6743\u9650\u6a21\u578b"),(0,r.kt)("p",null,"RBAC\u6743\u9650\u6a21\u578b\uff08Role-Based Access Control\uff09\u5373\uff1a\u57fa\u4e8e\u89d2\u8272\u7684\u6743\u9650\u63a7\u5236\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7528\u6237\uff1a\u7cfb\u7edf\u63a5\u53e3\u53ca\u529f\u80fd\u8bbf\u95ee\u7684\u64cd\u4f5c\u8005"),(0,r.kt)("li",{parentName:"ul"},"\u6743\u9650\uff1a\u80fd\u591f\u8bbf\u95ee\u67d0\u63a5\u53e3\u6216\u8005\u505a\u67d0\u64cd\u4f5c\u7684\u6388\u6743\u8d44\u683c"),(0,r.kt)("li",{parentName:"ul"},"\u89d2\u8272\uff1a\u5177\u6709\u4e00\u7c7b\u76f8\u540c\u64cd\u4f5c\u6743\u9650\u7684\u7528\u6237\u7684\u603b\u79f0")),(0,r.kt)("p",null,"RBAC\u6743\u9650\u6a21\u578b\u6838\u5fc3\u6388\u6743\u903b\u8f91\u5982\u4e0b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u67d0\u7528\u6237\u662f\u4ec0\u4e48\u89d2\u8272\uff1f"),(0,r.kt)("li",{parentName:"ul"},"\u67d0\u89d2\u8272\u5177\u6709\u4ec0\u4e48\u6743\u9650\uff1f"),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u89d2\u8272\u7684\u6743\u9650\u63a8\u5bfc\u7528\u6237\u7684\u6743\u9650")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gitee.com/kyrzy0416/imagebed/raw/master/img/image-20210527230359492.png",alt:"image-20210527230359492"})),(0,r.kt)("h2",{id:"\u52a8\u6001\u52a0\u8f7drbac\u6570\u636e"},"\u52a8\u6001\u52a0\u8f7dRBAC\u6570\u636e"),(0,r.kt)("p",null,"\u63d0\u7eb2\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Dao\u5c42\u5b9e\u73b0UserDetails\u63a5\u53e3\uff0c\u8bbe\u7f6eset\u65b9\u6cd5"),(0,r.kt)("li",{parentName:"ul"},"Service\u5c42\u5b9e\u73b0UserDetailsService\u63a5\u53e3\uff0c\u5b8c\u6210loadUserByUsername\u65b9\u6cd5"),(0,r.kt)("li",{parentName:"ul"},"\u914d\u7f6eSecurity\u4e2d\u7684configure(AuthenticationManagerBuilder auth)")),(0,r.kt)("h3",{id:"\u5b9e\u73b0dao\u5c42\u63a5\u53e3\u548cservice\u63a5\u53e3"},"\u5b9e\u73b0Dao\u5c42\u63a5\u53e3\u548cService\u63a5\u53e3"),(0,r.kt)("h4",{id:"\u5b9e\u73b0dao\u5c42"},"\u5b9e\u73b0Dao\u5c42"),(0,r.kt)("p",null,"\u9996\u5148\u521b\u5efa\u81ea\u5df1\u7684DAO\u5c42\u7c7b\uff0c\u5b9e\u73b0UserDetails\u63a5\u53e3\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyUserDetails implements UserDetails\n"))),(0,r.kt)("p",null,"\u52a0\u5165\u76f8\u5e94\u7684\u5b9e\u4f53\u7c7b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"String password;  //\u5bc6\u7801\nString username;  //\u7528\u6237\u540d\nboolean accountNonExpired;   //\u662f\u5426\u6ca1\u8fc7\u671f\nboolean accountNonLocked;   //\u662f\u5426\u6ca1\u88ab\u9501\u5b9a\nboolean credentialsNonExpired;  //\u5bc6\u7801\u662f\u5426\u6ca1\u8fc7\u671f\nboolean enabled;  //\u8d26\u53f7\u662f\u5426\u53ef\u7528\n")),(0,r.kt)("p",null,"\u8bbe\u7f6e\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"}," IDEA\u4e2dGenerator -- Setter\u5373\u53ef\u8bbe\u7f6e\u6210\u529f")),(0,r.kt)("p",null,"\u5b9e\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,"\u6ce8\u610f\u70b9\uff08\u6b64\u5751\u6574\u6574\u6d6a\u8d39\u4e863\u5929\u65f6\u95f4\uff09\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728\u8bbe\u7f6eenable\u7684\u65f6\u5019\u6ce8\u610f\u4e66\u5199enable\uff0c\u4e0d\u8981\u5199\u6210enabled\u6216\u8005\u5176\u4ed6\uff0c\u4e0d\u7136\u65e0\u6cd5\u4eceMybatis\u4e2d\u53d6\u51fa\u6570\u636e\uff0c\u5bfc\u81f4\u9ed8\u8ba4\u662ffalse\u4e00\u76f4\u767b\u9646\u4e0d\u4e0a\u53bb\uff01"),(0,r.kt)("li",{parentName:"ul"},"\u5728\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58enable\u5b57\u6bb5\u5e94\u4f7f\u7528tinyint")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyUserDetails implements UserDetails {\n\n    String password;  //\u5bc6\u7801\n    String username;  //\u7528\u6237\u540d\n    boolean accountNonExpired;   //\u662f\u5426\u6ca1\u8fc7\u671f\n    boolean accountNonLocked;   //\u662f\u5426\u6ca1\u88ab\u9501\u5b9a\n    boolean credentialsNonExpired;  //\u5bc6\u7801\u662f\u5426\u6ca1\u8fc7\u671f\n    boolean enable;  //\u8d26\u53f7\u662f\u5426\u53ef\u7528\n    Collection<? extends GrantedAuthority> authorities;  //\u7528\u6237\u7684\u6743\u9650\u96c6\u5408\n\n    @Override\n    public Collection<? extends GrantedAuthority> getAuthorities() {\n        return authorities;\n    }\n\n    @Override\n    public String getPassword() {\n        return password;\n    }\n\n    @Override\n    public String getUsername() {\n        return username;\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return enable;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public void setAccountNonExpired(boolean accountNonExpired) {\n        this.accountNonExpired = accountNonExpired;\n    }\n\n    public void setAccountNonLocked(boolean accountNonLocked) {\n        this.accountNonLocked = accountNonLocked;\n    }\n\n    public void setCredentialsNonExpired(boolean credentialsNonExpired) {\n        this.credentialsNonExpired = credentialsNonExpired;\n    }\n\n    public void setEnable(boolean enable) {\n        this.enable = enable;\n    }\n\n    public void setAuthorities(Collection<? extends GrantedAuthority> authorities) {\n        this.authorities = authorities;\n    }\n}\n")),(0,r.kt)("h4",{id:"\u5b9e\u73b0service\u5c42"},"\u5b9e\u73b0Service\u5c42"),(0,r.kt)("p",null,"\u9996\u5148\u521b\u5efa\u81ea\u5df1\u7684Service\u5c42\u7c7b\uff0c\u5b9e\u73b0UserDetailsService\u63a5\u53e3\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyUserDetailService implements UserDetailsService\n"))),(0,r.kt)("p",null,'\u7d27\u63a5\u7740\u5b9e\u73b0loadUserByUsername\u63a5\u53e3\uff08username\u662f\u5728SecurityConfig\u4e2d\u7684 .usernameParameter("username") \u83b7\u53d6\u5230\u7684\uff09\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5b9e\u73b0loadUserByUsername\u65b9\u6cd5'),(0,r.kt)("p",null,"\u5728\u5b9e\u73b0\u63a5\u53e3\u4e4b\u524d\u8981\u521b\u5efa\u4e00\u4e2a\u67e5\u8be2\u6570\u636e\u5e93\u67e5\u8be2\uff0c\u67e5\u8be2\u51fa\u7528\u6237\u7684\u8d26\u53f7\u5bc6\u7801\u548c\u662f\u5426\u53ef\u7528\u7684\u4fe1\u606f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public interface MyUserDetailsServiceMapper {\n\n    //\u6839\u636euserID\u67e5\u8be2\u7528\u6237\u4fe1\u606f\n    @Select("SELECT username,password,enable\\n" +\n            "FROM sys_user u\\n" +\n            "WHERE u.username = #{userId}")\n    MyUserDetails findByUserName(@Param("userId") String userId);\n')),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u6210\u529f\u540e\u5c31\u53ef\u4ee5\u5f00\u59cb\u7ee7\u7eed\u5b9e\u73b0UserDetailsService\u63a5\u53e3\uff0c\u9996\u5148\u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u7684\u57fa\u672c\u4fe1\u606f\u3001\u89d2\u8272\u3001\u6743\u9650\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u7528\u6237\u57fa\u7840\u6570\u636e\nMyUserDetails userDetails = mapper.findByUserName(username);\nif (userDetails == null) {\n    throw new UsernameNotFoundException("\u7528\u6237\u540d\u4e0d\u5b58\u5728");\n}\nSystem.out.println("current user enable: " + userDetails.isEnabled());\n\n// \u7528\u6237\u89d2\u8272\u5217\u8868\nList<String> roleCodes = mapper.findRoleByUserName(username);\n// \u6839\u636e\u89d2\u8272\u5217\u8868\u52a0\u8f7d\u5f53\u524d\u7528\u6237\u5177\u6709\u7684\u6743\u9650\nList<String> authorities = mapper.findAuthorityByRoleCodes(roleCodes);\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u4e3a\u89d2\u8272\u6807\u8bc6\u52a0\u4e0aROLE_\u524d\u7f00\uff08Spring Security\u89c4\u8303\uff09")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'roleCodes = roleCodes.stream()\n                .map(rc -> "ROLE_" + rc)\n                .collect(Collectors.toList());\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u5408\u5e76\u89d2\u8272\u6743\u9650\uff0c\u4ee5\u2018\uff0c\u2019\u5206\u5f00\u6743\u9650\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'//\u89d2\u8272\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6743\u9650\uff0c\u6240\u4ee5\u5408\u5e76\nauthorities.addAll(roleCodes);\n//\u8f6c\u6210\u7528\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\uff0c\u4e3a\u7528\u6237\u8bbe\u7f6e\u6743\u9650\u6807\u8bc6\nuserDetails.setAuthorities(AuthorityUtils.commaSeparatedStringToAuthorityList(\n    String.join(",", authorities)\n));\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"\u6700\u540e\u8fd4\u56de\u5b9e\u4f53\u7c7b\uff0c\u52a0\u4e0a@Component\u5230\u7c7b\u4e0a\u5373\u53ef\u5373\u53ef")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"return userDetails;\n")),(0,r.kt)("p",null,"\u5b8c\u6574\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class MyUserDetailService implements UserDetailsService {\n\n    @Resource\n    private MyUserDetailsServiceMapper mapper;\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        // \u7528\u6237\u57fa\u7840\u6570\u636e\n        MyUserDetails userDetails = mapper.findByUserName(username);\n        if (userDetails == null) {\n            throw new UsernameNotFoundException("\u7528\u6237\u540d\u4e0d\u5b58\u5728");\n        }\n        System.out.println("current user enable: " + userDetails.isEnabled());\n\n        // \u7528\u6237\u89d2\u8272\u5217\u8868\n        List<String> roleCodes = mapper.findRoleByUserName(username);\n        // \u6839\u636e\u89d2\u8272\u5217\u8868\u52a0\u8f7d\u5f53\u524d\u7528\u6237\u5177\u6709\u7684\u6743\u9650\n        List<String> authorities = mapper.findAuthorityByRoleCodes(roleCodes);\n\n        //\u4e3a\u89d2\u8272\u6807\u8bc6\u52a0\u4e0aROLE_\u524d\u7f00\uff08Spring Security\u89c4\u8303\uff09\n        roleCodes = roleCodes.stream()\n                .map(rc -> "ROLE_" + rc)\n                .collect(Collectors.toList());\n        //\u89d2\u8272\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6743\u9650\uff0c\u6240\u4ee5\u5408\u5e76\n        authorities.addAll(roleCodes);\n        //\u8f6c\u6210\u7528\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\uff0c\u4e3a\u7528\u6237\u8bbe\u7f6e\u6743\u9650\u6807\u8bc6\n        userDetails.setAuthorities(AuthorityUtils.commaSeparatedStringToAuthorityList(\n                String.join(",", authorities)\n        ));\n        System.out.println(userDetails);\n        return userDetails;\n    }\n}\n')),(0,r.kt)("h4",{id:"\u5b9e\u73b0\u540e\u7684\u914d\u7f6e"},"\u5b9e\u73b0\u540e\u7684\u914d\u7f6e"),(0,r.kt)("p",null,"\u5b8c\u6210\u4ee5\u540e\uff0c\u5728Spring Security\u7684\u914d\u7f6e\u7c7b\u4e2d\uff0c\u6ce8\u5165Service\uff0c\u914d\u7f6eAuthenticationManagerBuilder\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Resource\nprivate MyUserDetailService myUserDetailService;\n\n...\n    \n@Override\npublic void configure(AuthenticationManagerBuilder auth) throws Exception {\n    auth.userDetailsService(myUserDetailService)\n        .passwordEncoder(passwordEncoder());\n}\n")),(0,r.kt)("h3",{id:"\u8d44\u6e90\u9274\u6743\u89c4\u5219"},"\u8d44\u6e90\u9274\u6743\u89c4\u5219"),(0,r.kt)("p",null,"\u7b80\u800c\u8a00\u4e4b\uff1a\u5f53\u524d\u8bbf\u95ee\u7684\u8def\u5f84\u548c\u5f53\u524d\u7528\u6237\u6240\u62e5\u6709\u6743\u9650\u7684\u8def\u5f84\u662f\u5426\u5339\u914d"),(0,r.kt)("h4",{id:"\u521b\u5efa\u4e00\u4e2arbac\u7c7b"},"\u521b\u5efa\u4e00\u4e2aRBAC\u7c7b"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u7684RBAC\u7c7b")),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyRBACService\n"))),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5\uff0c\u65b9\u6cd5\u540d\u53ef\u4ee5\u81ea\u62df\uff0c\u65b9\u6cd5\u56fa\u5b9a")),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public boolean hasPermission(HttpServletRequest request, Authentication authentication)\n"))),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u4e3b\u4f53\u4fe1\u606f -> \u5224\u65ad\u662f\u5426\u662fUserDetails -> \u8f6c\u6362 -> \u83b7\u53d6\u672c\u6b21\u8bbf\u95ee\u7684\u8d44\u6e90\uff08\u8def\u5f84\uff09 -> \u5224\u65ad\u4e3b\u4f53\u662f\u5426\u542b\u6709\u8fd9\u4e2a\u8d44\u6e90 -> \u8fd4\u56de")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public boolean hasPermission(HttpServletRequest request, Authentication authentication) {\n    // \u5f53\u524d\u8ba4\u8bc1\u7684\u4e3b\u4f53\u4fe1\u606f\n    Object principal = authentication.getPrincipal();\n\n    if (principal instanceof UserDetails) {\n        UserDetails userDetails = (UserDetails) principal;\n\n        // \u672c\u6b21\u8981\u8bbf\u95ee\u7684\u8d44\u6e90\n        SimpleGrantedAuthority simpleGrantedAuthority\n            = new SimpleGrantedAuthority(request.getRequestURI());\n\n        // userDetails.getAuthorities()\u8be5\u7528\u6237\u6240\u80fd\u8bbf\u95ee\u7684\u6240\u6709\u8d44\u6e90\n        return userDetails.getAuthorities().contains(simpleGrantedAuthority);\n    }\n    return false;\n}\n")),(0,r.kt)("h4",{id:"\u914d\u7f6e\u7c7b\u66f4\u6362"},"\u914d\u7f6e\u7c7b\u66f4\u6362"),(0,r.kt)("p",null,"\u539f\u5148\u5728\u914d\u7f6e\u7c7b\u4e2d\u914d\u7f6e\u5199\u6b7b\u7684\u65b9\u6cd5\u5c31\u53ef\u4ee5\u53bb\u9664\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gitee.com/kyrzy0416/imagebed/raw/master/img/image-20210529162007567.png",alt:"image-20210529162007567"})),(0,r.kt)("p",null,"\u5c06antMatchers().hasAuthority\u6362\u4e3a\u8fd9\u4e2aSPEL\u8868\u8fbe\u5f0f\u5373\u53ef\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'.anyRequest().access("@rbacService.hasPermission(request,authentication)")\n'))),(0,r.kt)("h2",{id:"spel\u6743\u9650\u8868\u8fbe\u5f0f"},"SPEL\u6743\u9650\u8868\u8fbe\u5f0f"),(0,r.kt)("p",null,"Spring Express Language"),(0,r.kt)("h3",{id:"\u5e38\u7528\u6743\u9650\u8868\u8fbe\u5f0f"},"\u5e38\u7528\u6743\u9650\u8868\u8fbe\u5f0f"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"\u8868\u8fbe\u5f0f\u51fd\u6570"),(0,r.kt)("th",{parentName:"tr",align:"left"},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"hasRole([role]"),")"),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u7528\u6237\u62e5\u6709\u6307\u5b9a\u7684\u89d2\u8272\u65f6\u8fd4\u56detrue \uff08",(0,r.kt)("inlineCode",{parentName:"td"},"Spring security"),"\u9ed8\u8ba4\u4f1a\u5e26\u6709",(0,r.kt)("inlineCode",{parentName:"td"},"ROLE_"),"\u524d\u7f00\uff09,\u53bb\u9664\u524d\u7f00\u53c2\u8003",(0,r.kt)("a",{parentName:"td",href:"https://github.com/spring-projects/spring-security/issues/4134"},"Remove the ROLE_"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"hasAnyRole([role1,role2])")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u7528\u6237\u62e5\u6709\u4efb\u610f\u4e00\u4e2a\u6307\u5b9a\u7684\u89d2\u8272\u65f6\u8fd4\u56detrue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"hasAuthority([authority])")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u62e5\u6709\u67d0\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u65f6\u8fd4\u56detrue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"hasAnyAuthority([auth1,auth2])")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u62e5\u6709\u67d0\u4e9b\u8d44\u6e90\u5176\u4e2d\u90e8\u5206\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u65f6\u8fd4\u56detrue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"permitAll")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u6c38\u8fdc\u8fd4\u56detrue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"denyAll")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u6c38\u8fdc\u8fd4\u56defalse")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"anonymous")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5f53\u524d\u7528\u6237\u662f",(0,r.kt)("inlineCode",{parentName:"td"},"anonymous"),"\u65f6\u8fd4\u56detrue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"rememberMe")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5f53\u524d\u7528\u6237\u662f",(0,r.kt)("inlineCode",{parentName:"td"},"rememberMe"),"\u7528\u6237\u8fd4\u56detrue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"authentication")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5f53\u524d\u767b\u5f55\u7528\u6237\u7684",(0,r.kt)("inlineCode",{parentName:"td"},"authentication"),"\u5bf9\u8c61")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"fullAuthenticated")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u5f53\u524d\u7528\u6237\u65e2\u4e0d\u662f",(0,r.kt)("inlineCode",{parentName:"td"},"anonymous"),"\u4e5f\u4e0d\u662f",(0,r.kt)("inlineCode",{parentName:"td"},"rememberMe"),"\u7528\u6237\u65f6\u8fd4\u56detrue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"hasIpAddress('192.168.1.0/24')")),(0,r.kt)("td",{parentName:"tr",align:"left"},"\u8bf7\u6c42\u53d1\u9001\u7684IP\u5339\u914d\u65f6\u8fd4\u56detrue")))),(0,r.kt)("h4",{id:"permitall\u6743\u9650\u793a\u4f8b"},"permitALL()\u6743\u9650\u793a\u4f8b"),(0,r.kt)("p",null,"\u5728security\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u662f\u8fd9\u6837\u914d\u7f6e\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u8fdb\u5165\u7684\u8def\u5f84\u7684\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'.antMatchers("/login.html","/login").permitAll()\n'))),(0,r.kt)("p",null,"\u7136\u800c\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528\u53e6\u5916\u4e00\u79cd\u65b9\u5f0f\u6765\u5b9e\u73b0\u5b83\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'.antMatchers("/login.html","/login").access("permitAll()")\n'))),(0,r.kt)("h3",{id:"method\u8868\u8fbe\u5f0f\u5b89\u5168\u63a7\u5236"},"Method\u8868\u8fbe\u5f0f\u5b89\u5168\u63a7\u5236"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"@PreAuthorize \u6ce8\u89e3\u9002\u5408\u8fdb\u5165\u65b9\u6cd5\u524d\u7684\u6743\u9650\u9a8c\u8bc1\u3002")),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@PreAuthorize(\"hasRole('admin')\")\n"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"@PostAuthorize \u5728\u65b9\u6cd5\u6267\u884c\u540e\u518d\u8fdb\u884c\u6743\u9650\u9a8c\u8bc1,\u9002\u5408\u6839\u636e\u8fd4\u56de\u503c\u7ed3\u679c\u8fdb\u884c\u6743\u9650\u9a8c\u8bc1\u3002")),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@PostAuthorize("returnObject.name == authentication.name")\n'))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"@PreFilter \u9488\u5bf9\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4,\u4e0b\u6587\u4ee3\u7801\u8868\u793a\u9488\u5bf9ids\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4\uff0c\u53ea\u6709id\u4e3a\u5076\u6570\u7684\u5143\u7d20\u624d\u88ab\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u51fd\u6570\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'//\u5f53\u6709\u591a\u4e2a\u5bf9\u8c61\u662f\u4f7f\u7528filterTarget\u8fdb\u884c\u6807\u6ce8\n@PreFilter(filterTarget="ids", value="filterObject%2==0")\npublic void delete(List<Integer> ids, List<String> usernames) {\n\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"@PostFilter \u9488\u5bf9\u8fd4\u56de\u7ed3\u679c\u8fdb\u884c\u8fc7\u6ee4\uff0c\u7279\u522b\u9002\u7528\u4e8e\u96c6\u5408\u7c7b\u8fd4\u56de\u503c\uff0c\u8fc7\u6ee4\u96c6\u5408\u4e2d\u4e0d\u7b26\u5408\u8868\u8fbe\u5f0f\u7684\u5bf9\u8c61\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@PostFilter("filterObject.name == authentication.name")\npublic List<PersonDemo> findAllPD(){\n\n    List<PersonDemo> list = new ArrayList<>();\n    list.add(new PersonDemo("kobe"));\n    list.add(new PersonDemo("admin"));\n\n    return list;\n}\n')),(0,r.kt)("p",null,"\u5728\u5168\u5c40\u914d\u7f6e\u4e2d\u5f00\u542f\u6ce8\u89e3\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\n@EnableGlobalMethodSecurity(prePostEnabled = true)\npublic class MySecurityConfig extends WebSecurityConfigurerAdapter {\n")),(0,r.kt)("h2",{id:"rememberme-\u8bb0\u4f4f\u6211"},"RememberMe \u8bb0\u4f4f\u6211"),(0,r.kt)("h3",{id:"\u57fa\u7840\u77e5\u8bc6"},"\u57fa\u7840\u77e5\u8bc6"),(0,r.kt)("p",null,"\u5728Spring Security\u4e2d\uff0cRemember Me\u7684\u4e24\u5927\u6838\u5fc3\u662f"),(0,r.kt)("p",null,"\u540e\u7aef\u5168\u5c40\u914d\u7f6e\u7c7b\u52a0\u4e0arememberMe()\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.rememberMe();   //\u5b9e\u73b0\u8bb0\u4f4f\u6211\u81ea\u52a8\u767b\u5f55\u914d\u7f6e\uff0c\u6838\u5fc3\u7684\u4ee3\u7801\u53ea\u6709\u8fd9\u4e00\u884c\n    }\n}\n")),(0,r.kt)("p",null,"\u524d\u7aef\u4f20\u5165\u7528\u6237\u662f\u5426\u70b9\u51fb\u4e86Checkbox\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<label><input type="checkbox" name="remember-me"/>\u8bb0\u4f4f\u5bc6\u7801</label>\n'))),(0,r.kt)("p",null,"\u5b83\u6709\u4e24\u4e2a\u9ed8\u8ba4\u884c\u4e3a\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\uff0c\u5982\u679c\u8981\u5224\u65ad\u662f\u5426\u4e3a\u8bb0\u4f4f\u6211\uff0c\u4e0a\u4f20\u7684\u6570\u636e\u540d\u9ed8\u8ba4\u4e3a"remember-me"\uff1a')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"data: {\n    username,\n    password,\n    'remember-me': rememberMe\n},\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"2\u5468\u5185\u514d\u767b\u5f55")),(0,r.kt)("p",null,"Spring Security\u7684\u8bb0\u4f4f\u6211cookie\u4f7f\u7528Base64\u5b9e\u73b0\u7684\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"YWRtaW46MTYyMzQ5MzU2MTE2NTo2ZTk0NTNlZjkxZDcyYTU1MDU0YTczNWI0Y2I0YmM5Mw")),(0,r.kt)("p",null,"\u89e3\u5bc6\u540e\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"admin:1623493561165:6e9453ef91d72a55054a735b4cb4bc93")),(0,r.kt)("p",null,"signatureValue = username\u3001expirationTime\u548cpasswod\u548c\u4e00\u4e2a\u9884\u5b9a\u4e49\u7684key\uff0c\u5e76\u5c06\u4ed6\u4eec\u7ecf\u8fc7MD5\u8fdb\u884c\u7b7e\u540d"),(0,r.kt)("p",null,"\u5b83\u6709\u8fd9\u6837\u7684\u6267\u884c\u6d41\u7a0b\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gitee.com/kyrzy0416/imagebed/raw/master/img/e97c1601ac0850797df5683349d486ce_1501x327.png",alt:"img"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e00\u6b21\u767b\u5f55\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u7528\u6237\u4f7f\u7528\u5176\u4ed6\u9a8c\u8bc1\u65b9\u5f0f\u8fdb\u884c\u767b\u5f55\uff08\u5982\u7528\u6237\u540d\u5bc6\u7801\uff09\uff0c\u52fe\u9009remember-me\uff0c\u5e76\u751f\u6210RememberMeToken \u4ee4\u724c\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u6b21\u767b\u9646\u7684\u65f6\u5019\u4f7f\u7528RememberMeToken\u4ee4\u724c\uff08\u5c31\u4e0d\u7528\u8f93\u5165\u7528\u6237\u540d\u5bc6\u7801\u4e86\uff09\uff0cRememberMeAuthenticationFilter\u5728Spring Security\u8fc7\u6ee4\u5668\u94fe\u4e2d\u5904\u4e8e\u6574\u4f53\u504f\u540e\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u53ea\u6709\u5f53\u5404\u79cd\u4f20\u7edf\u7684\u767b\u5f55\u65b9\u5f0f\u90fd\u65e0\u6cd5\u5b8c\u6210\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u8d70RememberMeAuthenticationFilter\uff0c\u8fd9\u4e5f\u662f\u7b26\u5408\u5b9e\u9645\u9700\u6c42\u7684\u3002")),(0,r.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u914d\u7f6e"},"\u81ea\u5b9a\u4e49\u914d\u7f6e"),(0,r.kt)("p",null,"\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'.rememberMe()\n    .rememberMeParameter("remember-me-new")\n    .rememberMeCookieName("remember-me-cookie")\n    .tokenValiditySeconds(2 * 24 * 60 * 60);  \n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"tokenValiditySeconds\u7528\u4e8e\u8bbe\u7f6etoken\u7684\u6709\u6548\u671f\uff0c\u5373\u591a\u957f\u65f6\u95f4\u5185\u53ef\u4ee5\u514d\u9664\u91cd\u590d\u767b\u5f55\uff0c\u5355\u4f4d\u662f\u79d2\u3002\u4e0d\u4fee\u6539\u914d\u7f6e\u60c5\u51b5\u4e0b\u9ed8\u8ba4\u662f2\u5468\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7rememberMeParameter\u8bbe\u7f6efrom\u8868\u5355\u201c\u81ea\u52a8\u767b\u5f55\u201d\u52fe\u9009\u6846\u7684\u53c2\u6570\u540d\u79f0\u3002\u5982\u679c\u8fd9\u91cc\u6539\u4e86\uff0cfrom\u8868\u5355\u4e2dcheckbox\u7684name\u5c5e\u6027\u8981\u5bf9\u5e94\u7684\u66f4\u6539\u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u662fremember-me\u3002"),(0,r.kt)("li",{parentName:"ul"},"rememberMeCookieName\u8bbe\u7f6e\u4e86\u4fdd\u5b58\u5728\u6d4f\u89c8\u5668\u7aef\u7684cookie\u7684\u540d\u79f0\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u4e5f\u662fremember-me\u3002\u5982\u4e0b\u56fe\u4e2d\u67e5\u770b\u6d4f\u89c8\u5668\u7684cookie\u3002")),(0,r.kt)("h3",{id:"\u6570\u636e\u5e93\u5b9e\u73b0"},"\u6570\u636e\u5e93\u5b9e\u73b0"),(0,r.kt)("p",null,"\u6d41\u7a0b\u6267\u884c\u56fe\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gitee.com/kyrzy0416/imagebed/raw/master/img/52bfd1be308b140ce4f45df5ad95e23c_1344x517.png",alt:"img"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u952e\u4e00\u5f20\u6570\u636e\u5e93\u8868",(0,r.kt)("strong",{parentName:"li"},"persistent_logins"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE `persistent_logins` (\n  `username` varchar(64) NOT NULL,\n  `series` varchar(64) NOT NULL,\n  `token` varchar(64) NOT NULL,\n  `last_used` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  PRIMARY KEY (`series`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5728\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u7c7b\uff0c\u8fd4\u56dePersistentTokenRepository\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Autowired\nprivate DataSource dataSource;\n\n @Bean\n public PersistentTokenRepository persistentTokenRepository(){\n     JdbcTokenRepositoryImpl tokenRepository = new JdbcTokenRepositoryImpl();\n     tokenRepository.setDataSource(dataSource);\n     return tokenRepository;\n }\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u5728\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2dconfigure(HttpSecurity http)\u518d\u52a0\u5165\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},".rememberMe()\n    .tokenRepository(persistentTokenRepository())\n")),(0,r.kt)("h2",{id:"\u9000\u51fa\u767b\u5f55"},"\u9000\u51fa\u767b\u5f55"),(0,r.kt)("h3",{id:"\u6838\u5fc3\u914d\u7f6e"},"\u6838\u5fc3\u914d\u7f6e"),(0,r.kt)("p",null,"\u540e\u7aef\u5728configure(final HttpSecurity http) \u914d\u7f6e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\n@EnableWebSecurity\npublic class SecSecurityConfig extends WebSecurityConfigurerAdapter {\n    @Override\n    protected void configure(final HttpSecurity http) throws Exception {\n        http.logout();\n   }\n}\n")),(0,r.kt)("p",null,"\u524d\u7aef\u52a0\u5165\u9ed8\u8ba4\u8def\u5f84\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<a href="/logout" >\u9000\u51fa</a>\n'))),(0,r.kt)("p",null,"\u5728\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\uff0cSpring Security\u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u524dsession\u5931\u6548\uff0c\u5373\uff1alogout\u7684\u6838\u5fc3\u9700\u6c42\uff0csession\u5931\u6548\u5c31\u662f\u8bbf\u95ee\u6743\u9650\u7684\u56de\u6536\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5220\u9664\u5f53\u524d\u7528\u6237\u7684 remember-me\u201c\u8bb0\u4f4f\u6211\u201d\u529f\u80fd\u4fe1\u606f\uff08\u5185\u5b58\u548c\u6570\u636e\u5e93\uff09"),(0,r.kt)("li",{parentName:"ul"},"clear\u6e05\u9664\u5f53\u524d\u7684 SecurityContext"),(0,r.kt)("li",{parentName:"ul"},"\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875\u9762\uff0cloginPage\u914d\u7f6e\u9879\u6307\u5b9a\u7684\u9875\u9762")),(0,r.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u914d\u7f6e-1"},"\u81ea\u5b9a\u4e49\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},' http.logout()\n     .logoutUrl("/signout")\n     .logoutSuccessUrl("/aftersignout.html")\n     .deleteCookies("JSESSIONID")\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"logoutUrl  \u914d\u7f6e\u6539\u53d8\u9000\u51fa\u8bf7\u6c42\u7684\u9ed8\u8ba4\u8def\u5f84\uff0c\u5f53\u7136html\u9000\u51fa\u6309\u94ae\u7684\u8bf7\u6c42url\u4e5f\u8981\u4fee\u6539"),(0,r.kt)("li",{parentName:"ul"},"logoutSuccessUrl  \u914d\u7f6e\uff0c\u6765\u663e\u5f0f\u6307\u5b9a\u9000\u51fa\u4e4b\u540e\u7684\u8df3\u8f6c\u9875\u9762"),(0,r.kt)("li",{parentName:"ul"},"deleteCookies\xa0 \u5220\u9664\u6307\u5b9a\u7684cookie\uff0c\u53c2\u6570\u4e3acookie\u7684\u540d\u79f0")),(0,r.kt)("h3",{id:"\u914d\u7f6elogoutsuccesshandler"},"\u914d\u7f6eLogoutSuccessHandler"),(0,r.kt)("p",null,"\u5982\u679c\u8981\u5bf9\u6ce8\u9500\u767b\u5f55\u7684\u4e00\u4e9b\u4e1a\u52a1\u64cd\u4f5c\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u521b\u5efa\u7c7b\u5b9e\u73b0LogoutSuccessHandler \u7684\u63a5\u53e3\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyLogoutSuccessHandler implements LogoutSuccessHandler\n"))),(0,r.kt)("p",null,'\u5728\u63a5\u53e3\u51fd\u6570onLogoutSuccess\u4e2d\u5b9e\u73b0\u5b8c\u4e86\u4e1a\u52a1\uff0c\u8fd4\u56deresponse.sendRedirect("/login.html");'),(0,r.kt)("p",null,"\u5b8c\u6210\u4ee5\u540e\u5728\u5168\u5c40\u914d\u7f6econfigure (HttpSecurity http)\u4e2d\u52a0\u5165logoutSuccessHandler\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'http.logout()\n                    .deleteCookies("JSESSIONID")\n                    .logoutSuccessHandler(myLogoutSuccessHandler)\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u3010\u6ce8\u610f\u3011"),'\u5b9e\u73b0\u5b8cLogoutSuccessHandler\u4ee5\u540e\uff0c\u9700\u8981\u6ce8\u91calogoutUrl("")\uff0c\u4e0d\u7136\u65e0\u6cd5\u4f7f\u7528'),(0,r.kt)("h2",{id:"\u56fe\u7247\u9a8c\u8bc1"},"\u56fe\u7247\u9a8c\u8bc1"),(0,r.kt)("h3",{id:"\u5f15\u5165kaptcha"},"\u5f15\u5165Kaptcha"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n   <groupId>com.github.penggle</groupId>\n   <artifactId>kaptcha</artifactId>\n   <version>2.3.2</version>\n   <exclusions>\n      <exclusion>\n         <artifactId>javax.servlet-api</artifactId>\n         <groupId>javax.servlet</groupId>\n      </exclusion>\n   </exclusions>\n</dependency>\n")),(0,r.kt)("h3",{id:"\u5f15\u5165\u914d\u7f6e"},"\u5f15\u5165\u914d\u7f6e"),(0,r.kt)("p",null,"\u8be6\u7ec6\u914d\u7f6e\u8868\u6709\u5982\u4e0b\uff1a"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"kaptcha.border"),(0,r.kt)("th",{parentName:"tr",align:null},"\u56fe\u7247\u8fb9\u6846\uff0c\u5408\u6cd5\u503c\uff1ayes , no"),(0,r.kt)("th",{parentName:"tr",align:null},"yes"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.border.color"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8fb9\u6846\u989c\u8272\uff0c\u5408\u6cd5\u503c\uff1a r,g,b (and optional alpha) \u6216\u8005 white,black,blue."),(0,r.kt)("td",{parentName:"tr",align:null},"black")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.image.width"),(0,r.kt)("td",{parentName:"tr",align:null},"\u56fe\u7247\u5bbd"),(0,r.kt)("td",{parentName:"tr",align:null},"200")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.image.height"),(0,r.kt)("td",{parentName:"tr",align:null},"\u56fe\u7247\u9ad8"),(0,r.kt)("td",{parentName:"tr",align:null},"50")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.producer.impl"),(0,r.kt)("td",{parentName:"tr",align:null},"\u56fe\u7247\u5b9e\u73b0\u7c7b"),(0,r.kt)("td",{parentName:"tr",align:null},"com.google.code.kaptcha.impl.DefaultKaptcha")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.textproducer.impl"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6587\u672c\u5b9e\u73b0\u7c7b"),(0,r.kt)("td",{parentName:"tr",align:null},"com.google.code.kaptcha.text.impl.DefaultTextCreator")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.textproducer.char.string"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6587\u672c\u96c6\u5408\uff0c\u9a8c\u8bc1\u7801\u503c\u4ece\u6b64\u96c6\u5408\u4e2d\u83b7\u53d6"),(0,r.kt)("td",{parentName:"tr",align:null},"abcde2345678gfynmnpwx")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.textproducer.char.length"),(0,r.kt)("td",{parentName:"tr",align:null},"\u9a8c\u8bc1\u7801\u957f\u5ea6"),(0,r.kt)("td",{parentName:"tr",align:null},"5")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.textproducer.font.names"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5b57\u4f53"),(0,r.kt)("td",{parentName:"tr",align:null},"Arial, Courier")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.textproducer.font.size"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5b57\u4f53\u5927\u5c0f"),(0,r.kt)("td",{parentName:"tr",align:null},"40px.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.textproducer.font.color"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5b57\u4f53\u989c\u8272\uff0c\u5408\u6cd5\u503c\uff1a r,g,b \u6216\u8005 white,black,blue."),(0,r.kt)("td",{parentName:"tr",align:null},"black")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.textproducer.char.space"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6587\u5b57\u95f4\u9694"),(0,r.kt)("td",{parentName:"tr",align:null},"2")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.noise.impl"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5e72\u6270\u5b9e\u73b0\u7c7b"),(0,r.kt)("td",{parentName:"tr",align:null},"com.google.code.kaptcha.impl.DefaultNoise")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.noise.color"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5e72\u6270 \u989c\u8272\uff0c\u5408\u6cd5\u503c\uff1a r,g,b \u6216\u8005 white,black,blue."),(0,r.kt)("td",{parentName:"tr",align:null},"black")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.obscurificator.impl"),(0,r.kt)("td",{parentName:"tr",align:null},"\u56fe\u7247\u6837\u5f0f\uff1a",(0,r.kt)("br",null),"\u6c34\u7eb9 com.google.code.kaptcha.impl.WaterRipple ",(0,r.kt)("br",null),"\u9c7c\u773c com.google.code.kaptcha.impl.FishEyeGimpy ",(0,r.kt)("br",null),"\u9634\u5f71 com.google.code.kaptcha.impl.ShadowGimpy"),(0,r.kt)("td",{parentName:"tr",align:null},"com.google.code.kaptcha.impl.WaterRipple")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.background.impl"),(0,r.kt)("td",{parentName:"tr",align:null},"\u80cc\u666f\u5b9e\u73b0\u7c7b"),(0,r.kt)("td",{parentName:"tr",align:null},"com.google.code.kaptcha.impl.DefaultBackground")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.background.clear.from"),(0,r.kt)("td",{parentName:"tr",align:null},"\u80cc\u666f\u989c\u8272\u6e10\u53d8\uff0c\u5f00\u59cb\u989c\u8272"),(0,r.kt)("td",{parentName:"tr",align:null},"light grey")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.background.clear.to"),(0,r.kt)("td",{parentName:"tr",align:null},"\u80cc\u666f\u989c\u8272\u6e10\u53d8\uff0c \u7ed3\u675f\u989c\u8272"),(0,r.kt)("td",{parentName:"tr",align:null},"white")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.word.impl"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6587\u5b57\u6e32\u67d3\u5668"),(0,r.kt)("td",{parentName:"tr",align:null},"com.google.code.kaptcha.text.impl.DefaultWordRenderer")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.session.key"),(0,r.kt)("td",{parentName:"tr",align:null},"session key"),(0,r.kt)("td",{parentName:"tr",align:null},"KAPTCHA_SESSION_KEY")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"kaptcha.session.date"),(0,r.kt)("td",{parentName:"tr",align:null},"session date"),(0,r.kt)("td",{parentName:"tr",align:null},"KAPTCHA_SESSION_DATE")))),(0,r.kt)("p",null,"\u5728Spring Boot\u4e2d\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528YAML\u7684\u65b9\u5f0f\uff0c\u53ea\u80fd\u4f7f\u7528Properties\u7684\u65b9\u5f0f\u6765\u914d\u7f6e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"kaptcha.border=no\nkaptcha.border.color=105,179,90\nkaptcha.image.width=100\nkaptcha.image.height=45\nkaptcha.textproducer.font.color=blue\nkaptcha.textproducer.font.size=35\nkaptcha.textproducer.char.length=4\nkaptcha.textproducer.font.names=\u5b8b\u4f53,\u6977\u4f53,\u5fae\u8f6f\u96c5\u9ed1\n")),(0,r.kt)("p",null,"\u914d\u7f6e\u5b8c\u4e4b\u540e\u521b\u5efa\u914d\u7f6e\u7c7b\uff0c\u5012\u5165\u914d\u7f6e\u4fe1\u606f\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528@Value\u4ece\u914d\u7f6e\u4e2d\u5bfc\u5165\u503c"),(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efaDefaultKaptcha \u65b9\u6cd5\uff0c\u4e00\u822c\u53d6\u540d\u4e3a\uff1akaptchaProducer\uff0c\u52a0\u4e0a@Bean\u6ce8\u89e3",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u4f8b\u5316DefaultKaptcha\u3001Properties \u7c7b"),(0,r.kt)("li",{parentName:"ul"},"\u5229\u7528properties.setProperty\u5bfc\u5165\u914d\u7f6e"),(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u4f8b\u5316Config \u7c7b\uff0c\u4f20\u5165properties"),(0,r.kt)("li",{parentName:"ul"},"DefaultKaptcha\u5229\u7528\u8bbe\u7f6e\u914d\u7f6e\u7684\u65b9\u6cd5"),(0,r.kt)("li",{parentName:"ul"},"\u8fd4\u56deDefaultKaptcha"))),(0,r.kt)("li",{parentName:"ul"},"\u52a0\u4e0a@Component\u6ce8\u89e3\u548c@PropertySource\uff08\u6807\u6ce8peoperties\u7684\u4f4d\u7f6e\uff09")),(0,r.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\n@PropertySource(value = {"classpath:kaptcha.properties"})\npublic class CaptchaConfig {\n\n    @Value("${kaptcha.border}")\n    private String border;\n    @Value("${kaptcha.border.color}")\n    private String borderColor;\n    @Value("${kaptcha.textproducer.font.color}")\n    private String fontColor;\n    @Value("${kaptcha.image.width}")\n    private String imageWidth;\n    @Value("${kaptcha.image.height}")\n    private String imageHeight;\n    @Value("${kaptcha.textproducer.char.length}")\n    private String charLength;\n    @Value("${kaptcha.textproducer.font.names}")\n    private String fontNames;\n    @Value("${kaptcha.textproducer.font.size}")\n    private String fontSize;\n\n    @Bean(name = "captchaProducer")\n    public DefaultKaptcha getKaptchaBean() {\n        DefaultKaptcha defaultKaptcha = new DefaultKaptcha();\n        Properties properties = new Properties();\n        properties.setProperty("kaptcha.border", border);\n        properties.setProperty("kaptcha.border.color", borderColor);\n        properties.setProperty("kaptcha.textproducer.font.color", fontColor);\n        properties.setProperty("kaptcha.image.width", imageWidth);\n        properties.setProperty("kaptcha.image.height", imageHeight);\n        properties.setProperty("kaptcha.session.key", sessionKey);\n        properties.setProperty("kaptcha.textproducer.char.length", charLength);\n        properties.setProperty("kaptcha.textproducer.font.names", fontNames);\n        properties.setProperty("kaptcha.textproducer.font.size",fontSize);\n        Config config = new Config(properties);\n        defaultKaptcha.setConfig(config);\n        return defaultKaptcha;\n    }\n}\n')),(0,r.kt)("h3",{id:"\u9a8c\u8bc1\u7801\u5728session\u4e2d\u7684\u751f\u6210"},"\u9a8c\u8bc1\u7801\u5728Session\u4e2d\u7684\u751f\u6210"),(0,r.kt)("p",null,"\u5bfc\u8bfb\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"captchaProducer.createText() \u751f\u6210\u9a8c\u8bc1\u7801\u6587\u5b57"),(0,r.kt)("li",{parentName:"ul"},"KaptchaForm \u4fdd\u5b58Session\u4e2d\u9a8c\u8bc1\u7801\u7684\u4fe1\u606f\uff08\u9a8c\u8bc1\u7801\u3001\u8fc7\u671f\u65f6\u95f4\uff09")),(0,r.kt)("h4",{id:"\u521b\u5efa\u9a8c\u8bc1\u7801\u4fe1\u606f\u7c7b"},"\u521b\u5efa\u9a8c\u8bc1\u7801\u4fe1\u606f\u7c7b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class KaptchaForm {\n\n    private String code;\n\n    public LocalDateTime expireTime;\n\n    public KaptchaForm(String code, int expireAfterSeconds) {\n        this.code = code;\n        this.expireTime = LocalDateTime.now().plusSeconds(expireAfterSeconds);\n    }\n\n    public boolean isExpired() {\n        return LocalDateTime.now().isAfter(expireTime);\n    }\n\n    public String getCode() {\n        return code;\n    }\n}\n")),(0,r.kt)("h4",{id:"\u628a\u9a8c\u8bc1\u7801\u4f20\u5230session\u524d\u7aef"},"\u628a\u9a8c\u8bc1\u7801\u4f20\u5230Session\u524d\u7aef"),(0,r.kt)("p",null,"\u521b\u5efa\u4e00\u4e2aController\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\npublic class KaptchaController {\n\n    @Resource\n    private DefaultKaptcha kaptchaProducer;\n\n    @GetMapping("/kaptcha")\n    public void kaptcha(HttpSession session, HttpServletResponse response) {\n        response.setDateHeader("Expires", 0);\n        response.setHeader("Cache-Control", "no-store, no-cache, must-revalidate");\n        response.addHeader("Cache-Control", "post-check=0, pre-check=0");\n        response.setHeader("Pragma", "no-cache");\n        response.setContentType("image/jpeg");\n\n        String kaptchaText = kaptchaProducer.createText();\n        session.setAttribute(MyContent.KAPTCHA_SESSION_KEY, new KaptchaForm(kaptchaText, 2*60));\n        try(ServletOutputStream out = response.getOutputStream()) {\n            BufferedImage defaultKaptchaImage = kaptchaProducer.createImage(kaptchaText);\n            ImageIO.write(defaultKaptchaImage, "jpg", out);\n            out.flush();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n')),(0,r.kt)("p",null,"\u5728\u524d\u7aef\uff0c\u53ef\u4ee5\u7f6e\u968f\u673a\u6570\u6539\u53d8\u9a8c\u8bc1\u7801\u7684\u5185\u5bb9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'<script>\n    window.onload=function(){\n        var kaptchaImg = document.getElementById("kaptcha");\n        kaptchaImg.onclick = function(){\n            kaptchaImg.src = "/kaptcha?" + Math.floor(Math.random() * 100)\n        }\n    }\n<\/script>\n')),(0,r.kt)("h4",{id:"\u5b9e\u73b0\u540e\u7aef\u9a8c\u8bc1--\u9a8c\u8bc1\u7801"},"\u5b9e\u73b0\u540e\u7aef\u9a8c\u8bc1--\u9a8c\u8bc1\u7801"),(0,r.kt)("p",null,"\u6267\u884c\u6d41\u7a0b\u56fe\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gitee.com/kyrzy0416/imagebed/raw/master/img/e247197a4faf4269d8fb61e914538acf_741x180.png",alt:"img"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7f16\u5199\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u56fe\u7247\u9a8c\u8bc1\u7801\u8fc7\u6ee4\u5668KaptchaCodeFilter\uff0c\u8fc7\u6ee4\u5668\u4e2d\u62e6\u622a\u767b\u5f55\u8bf7\u6c42"),(0,r.kt)("li",{parentName:"ul"},"KaptchaCodeFilter\u8fc7\u6ee4\u5668\u4e2d\u4eceseesion\u83b7\u53d6\u9a8c\u8bc1\u7801\u6587\u5b57\u4e0e\u7528\u6237\u8f93\u5165\u6bd4\u5bf9\uff0c\u6bd4\u5bf9\u901a\u8fc7\u6267\u884c\u5176\u4ed6\u8fc7\u6ee4\u5668\u94fe"),(0,r.kt)("li",{parentName:"ul"},"\u6bd4\u5bf9\u4e0d\u901a\u8fc7\uff0c\u629b\u51faSessionAuthenticationException\u5f02\u5e38\uff0c\u4ea4\u7ed9AuthenticationFailureHandler\u5904\u7406"),(0,r.kt)("li",{parentName:"ul"},"\u6700\u540e\u5c06KaptchaCodeFilter\u653e\u5728UsernamePasswordAuthenticationFilter\u8868\u5355\u8fc7\u6ee4\u5668\u4e4b\u524d\u6267\u884c\u3002")),(0,r.kt)("p",null,"\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2aFilter\u7c7b\u7ee7\u627fOncePerRequestFilter "),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class KaptchaFilter extends OncePerRequestFilte\n"))),(0,r.kt)("p",null,"\u5b9e\u73b0doFilterInternal\u51fd\u6570\uff0c\u5728\u91cc\u9762\u4e3b\u8981\u505a\u524d\u7aef\u4f20\u5165\u7684\u9a8c\u8bc1\u7801\u662f\u5426\u6b63\u786e\u7684\u6821\u9a8c"),(0,r.kt)("p",null,"\u83b7\u53d6\u524d\u7aef\u6821\u9a8c\u7801\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'String codeInRequest = ServletRequestUtils.getStringParameter(\n        request.getRequest(),"kaptchaCode");\n'))),(0,r.kt)("p",null,"\u83b7\u53d6Session\u4e2d\u7684\u9a8c\u8bc1\u7801\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"KaptchaForm codeInSession = (KaptchaForm)\n        session.getAttribute(\u653e\u5165Session\u4e2d\u7684key);\n"))),(0,r.kt)("p",null,"\u63a5\u7740\u5c31\u53ef\u4ee5\u5224\u65ad\u9a8c\u8bc1\u7801\uff1a\u7a7a\u3001\u8fc7\u671f\u3001\u4e0d\u5339\u914d\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u6210\u529f\u5c31\u4e0d\u505a\u64cd\u4f5c\uff0c\u653e\u884c\uff1b\u5982\u679c\u5931\u8d25\u5219\u62e6\u622a\uff0c\u62e6\u622a\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"filterChain.doFilter(request, response);\n"))),(0,r.kt)("p",null,"\u6700\u540e\u5728\u7c7b\u4e0a\u52a0\u4e0a@Component\u6ce8\u89e3\uff0c\u5b8c\u6574\u7684\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,"\u6ce8\uff1areturn \u653e\u5728catch\u4e2d\uff0c\u5982\u679c\u653e\u5728\u5916\u9762\u524d\u7aef\u4f1a\u8fd4\u56deundefined"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class KaptchaFilter extends OncePerRequestFilter {\n\n    @Resource\n    private MyAuthenticationFailureHandler authenticationFailureHandler;\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request,\n                                    HttpServletResponse response,\n                                    FilterChain filterChain) throws ServletException, IOException {\n        if (StrUtil.equals("/login", request.getRequestURI())\n            && StrUtil.equalsIgnoreCase(request.getMethod(), "POST")) {\n            // \u9a8c\u8bc1\u8c1c\u5e95\u4e0e\u7528\u6237\u8f93\u5165\u662f\u5426\u5339\u914d\n            try {\n                validate(new ServletWebRequest(request));\n            } catch (AuthenticationException e) {\n                authenticationFailureHandler.onAuthenticationFailure(request,response, e);\n                return;\n            }\n        }\n\n        filterChain.doFilter(request, response);\n    }\n\n    private void validate(ServletWebRequest request) throws ServletRequestBindingException {\n        HttpSession session = request.getRequest().getSession();\n\n        // \u83b7\u53d6\u7528\u6237\u767b\u5f55\u754c\u9762\u8f93\u5165\u7684kaptchaCode(\u524d\u7aefAJAX\u4f20\u5165)\n        String codeInRequest = ServletRequestUtils.getStringParameter(\n                request.getRequest(),"kaptchaCode");\n        if(StrUtil.isEmpty(codeInRequest)){\n            throw new SessionAuthenticationException("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a");\n        }\n\n        // \u83b7\u53d6session\u6c60\u4e2d\u7684\u9a8c\u8bc1\u7801\u8c1c\u5e95\n        KaptchaForm codeInSession = (KaptchaForm)\n                session.getAttribute(MyContent.KAPTCHA_SESSION_KEY);\n        System.out.println(codeInSession.getCode());\n        if(Objects.isNull(codeInSession)) {\n            throw new SessionAuthenticationException("\u9a8c\u8bc1\u7801\u4e0d\u5b58\u5728");\n        }\n\n        // \u6821\u9a8c\u670d\u52a1\u5668session\u6c60\u4e2d\u7684\u9a8c\u8bc1\u7801\u662f\u5426\u8fc7\u671f\n        if(codeInSession.isExpired()) {\n            session.removeAttribute(MyContent.KAPTCHA_SESSION_KEY);\n            throw new SessionAuthenticationException("\u9a8c\u8bc1\u7801\u5df2\u7ecf\u8fc7\u671f");\n        }\n\n        // \u8bf7\u6c42\u9a8c\u8bc1\u7801\u6821\u9a8c\n        if(!StrUtil.equals(codeInSession.getCode(), codeInRequest)) {\n            throw new SessionAuthenticationException("\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d");\n        }\n\n    }\n}\n')),(0,r.kt)("p",null,"\u6700\u540e\u5728\u5168\u5c40\u914d\u7f6e\u7c7b\u4e2d\uff08configure (HttpSecurity http)\uff09\u4e2d\u52a0\u5165addFilterBefore\u5373\u53ef\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Override\n    protected void configure (HttpSecurity http) throws Exception {\n        http.addFilterBefore(kaptchaFilter, UsernamePasswordAuthenticationFilter.class)\n")),(0,r.kt)("p",null,"\u81f3\u6b64\uff0c\u9a8c\u8bc1\u7801\u7684\u529f\u80fd\u90fd\u5b9e\u73b0\u4e86\u3002"),(0,r.kt)("h2",{id:"\u524d\u540e\u7aef\u5206\u79bb\u7684\u5e94\u7528"},"\u524d\u540e\u7aef\u5206\u79bb\u7684\u5e94\u7528"),(0,r.kt)("h3",{id:"jwt\u5de5\u5177\u7c7b"},"JWT\u5de5\u5177\u7c7b"),(0,r.kt)("h4",{id:"jwt\u5de5\u5177\u7c7b\u6a21\u677f-1"},"JWT\u5de5\u5177\u7c7b\u6a21\u677f 1"),(0,r.kt)("h5",{id:"\u5f15\u5165jwt\u5de5\u5177\u5305"},"\u5f15\u5165JWT\u5de5\u5177\u5305"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>io.jsonwebtoken</groupId>\n    <artifactId>jjwt</artifactId>\n    <version>0.9.1</version>\n</dependency>\n")),(0,r.kt)("p",null,"\u5728YAML\u6587\u4ef6\u4e2d\u914d\u7f6e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jwt: \n  header: JWTHeaderName\n  secret: aabbccdd  \n  expiration: 3600000\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"secret\u662f\u7528\u6765\u4e3aJWT\u57fa\u7840\u4fe1\u606f\u52a0\u5bc6\u548c\u89e3\u5bc6\u7684\u5bc6\u94a5"),(0,r.kt)("li",{parentName:"ul"},"expiration\u662fJWT\u4ee4\u724c\u7684\u6709\u6548\u65f6\u95f4\uff08\u6beb\u79d2\uff09")),(0,r.kt)("h5",{id:"jwt\u6a21\u677f\u5f15\u5165"},"JWT\u6a21\u677f\u5f15\u5165"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Data\n@ConfigurationProperties(prefix = "jwt")\n@Component\npublic class JWTUtil {\n\n    private String secret;\n    private Long expiration;\n    private String header;\n\n\n    /**\n     * \u751f\u6210token\u4ee4\u724c\n     *\n     * @param userDetails \u7528\u6237\n     * @return \u4ee4token\u724c\n     */\n    public String generateToken(UserDetails userDetails) {\n        Map<String, Object> claims = new HashMap<>(2);\n        claims.put("sub", userDetails.getUsername());\n        claims.put("created", new Date());\n\n        return generateToken(claims);\n    }\n\n    /**\n     * \u4ece\u4ee4\u724c\u4e2d\u83b7\u53d6\u7528\u6237\u540d\n     *\n     * @param token \u4ee4\u724c\n     * @return \u7528\u6237\u540d\n     */\n    public String getUsernameFromToken(String token) {\n        String username;\n        try {\n            Claims claims = getClaimsFromToken(token);\n            username = claims.getSubject();\n        } catch (Exception e) {\n            username = null;\n        }\n        return username;\n    }\n\n    /**\n     * \u5224\u65ad\u4ee4\u724c\u662f\u5426\u8fc7\u671f\n     *\n     * @param token \u4ee4\u724c\n     * @return \u662f\u5426\u8fc7\u671f\n     */\n    public Boolean isTokenExpired(String token) {\n        try {\n            Claims claims = getClaimsFromToken(token);\n            Date expiration = claims.getExpiration();\n            return expiration.before(new Date());\n        } catch (Exception e) {\n            return false;\n        }\n    }\n\n    /**\n     * \u5237\u65b0\u4ee4\u724c\n     *\n     * @param token \u539f\u4ee4\u724c\n     * @return \u65b0\u4ee4\u724c\n     */\n    public String refreshToken(String token) {\n        String refreshedToken;\n        try {\n            Claims claims = getClaimsFromToken(token);\n            claims.put("created", new Date());\n            refreshedToken = generateToken(claims);\n        } catch (Exception e) {\n            refreshedToken = null;\n        }\n        return refreshedToken;\n    }\n\n    /**\n     * \u9a8c\u8bc1\u4ee4\u724c\n     *\n     * @param token       \u4ee4\u724c\n     * @param userDetails \u7528\u6237\n     * @return \u662f\u5426\u6709\u6548\n     */\n    public Boolean validateToken(String token, UserDetails userDetails) {\n\n        String username = getUsernameFromToken(token);\n        return (username.equals(userDetails.getUsername()) && !isTokenExpired(token));\n    }\n\n\n    /**\n     * \u4ececlaims\u751f\u6210\u4ee4\u724c,\u5982\u679c\u770b\u4e0d\u61c2\u5c31\u770b\u8c01\u8c03\u7528\u5b83\n     *\n     * @param claims \u6570\u636e\u58f0\u660e\n     * @return \u4ee4\u724c\n     */\n    private String generateToken(Map<String, Object> claims) {\n        Date expirationDate = new Date(System.currentTimeMillis() + expiration);\n        return Jwts.builder().setClaims(claims)\n                .setExpiration(expirationDate)\n                .signWith(SignatureAlgorithm.HS512, secret)\n                .compact();\n    }\n\n    /**\n     * \u4ece\u4ee4\u724c\u4e2d\u83b7\u53d6\u6570\u636e\u58f0\u660e,\u5982\u679c\u770b\u4e0d\u61c2\u5c31\u770b\u8c01\u8c03\u7528\u5b83\n     *\n     * @param token \u4ee4\u724c\n     * @return \u6570\u636e\u58f0\u660e\n     */\n    private Claims getClaimsFromToken(String token) {\n        Claims claims;\n        try {\n            claims = Jwts.parser().setSigningKey(secret).parseClaimsJws(token).getBody();\n        } catch (Exception e) {\n            claims = null;\n        }\n        return claims;\n    }\n}\n')),(0,r.kt)("h5",{id:"\u83b7\u53d6token"},"\u83b7\u53d6Token"),(0,r.kt)("p",null,"\u5148\u5e8f\uff1a\uff08\u5b98\u65b9\u6587\u6863\uff09\u4ecb\u7ecdAuthenticationManager \u3001SecurityContextHolder\u3001SecurityContext"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"AuthenticationManager \uff1aAuthenticationManager \u662f\u4e00\u4e2aAPI\uff0c\u5b9a\u4e49\u4e86Spring Security\u5982\u4f55\u8fc7\u6ee4\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u7136\u540e\u7531\u8c03\u7528AuthenticationManager \u7684\u63a7\u5236\u5668\u5728 SecurityContextHolder \u4e0a\u8bbe\u7f6e\u8fd4\u56de\u7684\u8eab\u4efd\u9a8c\u8bc1\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"SecurityContextHolder\uff1aSecurityContextHolder\u662fSpring Security\u5b58\u50a8\u5df2\u8ba4\u8bc1\u8eab\u4efd\u7684\u7ec6\u8282\u3002Spring Security \u4e0d\u5173\u5fc3 SecurityContextHolder \u662f\u5982\u4f55\u586b\u5145\u7684\u3002\u5982\u679c\u5b83\u5305\u542b\u4e00\u4e2a\u503c\uff0c\u5219\u5c06\u5176\u7528\u4f5c\u5f53\u524d\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u3002\u6307\u5b9a\u7528\u6237\u5df2\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u76f4\u63a5\u8bbe\u7f6e SecurityContextHolder\u3002"))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gitee.com/kyrzy0416/imagebed/raw/master/img/securitycontextholder.png",alt:"securitycontextholder"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"SecurityContext\uff1aSecurityContext \u662f\u4ece SecurityContextHolder \u83b7\u5f97\u7684\u3002 SecurityContext \u5305\u542b\u4e00\u4e2a Authentication \u5bf9\u8c61\uff08\u5305\u542b\u5982\u4e0b\u4fe1\u606f\uff09",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4e3b\u4f53\uff08principal\uff09 - \u6807\u8bc6\u7528\u6237\u3002\u5f53\u4f7f\u7528\u7528\u6237\u540d/\u5bc6\u7801\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u8fd9\u901a\u5e38\u662f UserDetails \u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u51ed\u636e\uff08credentials\uff09 - \u901a\u5e38\u662f\u5bc6\u7801\u3002\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5c06\u5728\u7528\u6237\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u540e\u88ab\u6e05\u9664\uff0c\u4ee5\u786e\u4fdd\u5b83\u4e0d\u4f1a\u6cc4\u9732\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u6743\u9650\uff08authorities\uff09 - GrantedAuthoritys \u662f\u6388\u4e88\u7528\u6237\u7684\u9ad8\u7ea7\u6743\u9650\u3002\u4e00\u4e9b\u793a\u4f8b\u662f\u89d2\u8272\u6216\u8303\u56f4\u3002")))),(0,r.kt)("p",null,"\u8ba4\u8bc1\u62e6\u622a\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://gitee.com/kyrzy0416/imagebed/raw/master/img/abstractauthenticationprocessingfilter.png",alt:"abstractauthenticationprocessingfilter"})),(0,r.kt)("p",null,"\u6709\u4e86\u8fd9\u4e9b\u5148\u884c\u77e5\u8bc6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u5168\u5c40\u914d\u7f6e\u7c7b\u4e2d\u521b\u5efa\u4e00\u4e2aAuthenticationManager\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Bean(name= BeanIds.AUTHENTICATION_MANAGER)\n@Override\npublic AuthenticationManager authenticationManager() throws Exception{\n    return super.authenticationManager();\n}\n")),(0,r.kt)("p",null,"\u9996\u5148\u521b\u5efa\u4e00\u4e2aService\uff0c\u7528\u4e8e\u5bf9JWTController\u4e2d\u5bf9JWT\u7684\u5904\u7406\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Service\npublic class JWTAuthService\n"))),(0,r.kt)("p",null,"\u7d27\u63a5\u7740\uff0c\u8981\u5bf9Login\u8fdb\u884c\u5904\u7406\uff0c\u5f53\u83b7\u53d6\u5f53\u8d26\u53f7\u548c\u5bc6\u7801\u65f6\uff0c\u5148\u5bf9\u8d26\u53f7\u548c\u5bc6\u7801\u521b\u5efa\u8ba4\u8bc1Token\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"UsernamePasswordAuthenticationToken upToken =\n        new UsernamePasswordAuthenticationToken(username, password);\n"))),(0,r.kt)("p",null,"\u5728AuthenticationManager\u4e2d\u83b7\u53d6\u7528\u6237\u7684\u6743\u9650\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Authentication authenticate = manager.authenticate(upToken);")),(0,r.kt)("p",null,"\u628a\u7528\u6237\u7684\u6743\u9650\u653e\u5165\u5230SecurityContext\u4e2d\uff0c\u4eceSecurityContextHolder\u83b7\u53d6\u5e76\u8bbe\u7f6e\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"SecurityContextHolder.getContext().setAuthentication(authenticate);\n"))),(0,r.kt)("p",null,"\u6700\u540e\u751f\u6210JWT\u8fd4\u56de\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"UserDetails userDetails = userDetailsService.loadUserByUsername(username);\nreturn jwtUtil.generateToken(userDetails);\n")),(0,r.kt)("p",null,"\u5b8c\u6574\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Resource\nAuthenticationManager manager;\n\n@Resource\nUserDetailsService userDetailsService;\n\n@Resource\nJWTUtil jwtUtil;\n\n/**\n     * \u767b\u5f55\u8ba4\u8bc1\u6362\u53d6JWT\u4ee4\u724c\n     *\n     * @return\n     */\npublic String login(String username, String password) throws CustomException{\n    try {\n        UsernamePasswordAuthenticationToken upToken =\n            new UsernamePasswordAuthenticationToken(username, password);\n        Authentication authenticate = manager.authenticate(upToken);\n        SecurityContextHolder.getContext().setAuthentication(authenticate);\n    } catch (AuthenticationException e) {\n        throw new CustomException(CustomExceptionType.USER_INPUT_ERROR,\n                                  "\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u4e0d\u6b63\u786e");\n    }\n    UserDetails userDetails = userDetailsService.loadUserByUsername(username);\n    return jwtUtil.generateToken(userDetails);\n}\n')),(0,r.kt)("p",null,"\u6700\u540e\u901a\u8fc7Controller\u5904\u7406\u54cd\u5e94\uff0c\u5237\u65b0\u4ee4\u724c\u540c\u7406\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},' @PostMapping("/authentication")\npublic R login(@RequestBody Map<String, String> map) {\n    String username = map.get("username");\n    String password = map.get("password");\n    if (StrUtil.isEmpty(username) || StrUtil.isEmpty(password)) {\n        return R.error(\n            new CustomException(CustomExceptionType.USER_INPUT_ERROR\n                                , "\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a")\n        );\n    }\n    try {\n        return R.success(jwtAuthService.login(username, password));\n    } catch (CustomException e) {\n        return R.error(e);\n    }\n}\n')),(0,r.kt)("p",null,"\u5237\u65b0\u4ee4\u724c\u7684\u4e1a\u52a1\u5c42\u5904\u7406\u548c\u63a7\u5236\u5c42\u5904\u7406\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/**\n* \u5237\u65b0\u4ee4\u724c(controller)\n* @return\n*/\n@PostMapping("/refreshToken")\npublic R refresh(@RequestHeader("token") String token) {\n    return R.success(jwtAuthService.refreshToken(token));\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// service\npublic String refreshToken(String oldToken) {\n    if (!jwtUtil.isTokenExpired(oldToken)) {\n        return jwtUtil.refreshToken(oldToken);\n    }\n    return null;\n}\n")),(0,r.kt)("h5",{id:"\u63a5\u53e3\u8bbf\u95ee\u9274\u6743\u8fc7\u6ee4\u5668"},"\u63a5\u53e3\u8bbf\u95ee\u9274\u6743\u8fc7\u6ee4\u5668"),(0,r.kt)("p",null,"\u5b9a\u4e49\u4e00\u4e2a\u62e6\u622a\u5668\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u62e6\u622a\u63a5\u53e3\u8bf7\u6c42\uff0c\u4ece\u8bf7\u6c42request\u83b7\u53d6token\uff0c\u4ecetoken\u4e2d\u89e3\u6790\u5f97\u5230\u7528\u6237\u540d"),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7UserDetailsService\u83b7\u5f97\u7cfb\u7edf\u7528\u6237\uff08\u4ece\u6570\u636e\u5e93\u3001\u6216\u5176\u4ed6\u5176\u5b58\u50a8\u4ecb\u8d28\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u6839\u636e\u7528\u6237\u4fe1\u606f\u548cJWT\u4ee4\u724c\uff0c\u9a8c\u8bc1\u7cfb\u7edf\u7528\u6237\u4e0e\u7528\u6237\u8f93\u5165\u7684\u4e00\u81f4\u6027\uff0c\u5e76\u5224\u65adJWT\u662f\u5426\u8fc7\u671f\u3002\u5982\u679c\u6ca1\u6709\u8fc7\u671f\uff0c\u81f3\u6b64\u8868\u660e\u4e86\u8be5\u7528\u6237\u7684\u786e\u662f\u8be5\u7cfb\u7edf\u7684\u7528\u6237\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7cfb\u7edf\u7528\u6237\u4e0d\u4ee3\u8868\u4f60\u53ef\u4ee5\u8bbf\u95ee\u6240\u6709\u7684\u63a5\u53e3\u3002\u6240\u4ee5\u9700\u8981\u6784\u9020UsernamePasswordAuthenticationToken\u4f20\u9012\u7528\u6237\u3001\u6743\u9650\u4fe1\u606f\uff0c\u5e76\u5c06\u8fd9\u4e9b\u4fe1\u606f\u901a\u8fc7authentication\u544a\u77e5Spring Security\u3002Spring Security\u4f1a\u4ee5\u6b64\u5224\u65ad\u4f60\u7684\u63a5\u53e3\u8bbf\u95ee\u6743\u9650\u3002")),(0,r.kt)("p",null,"\u6ce8\u610f\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u8fd9\u91cc\u4e4b\u6240\u4ee5\u80fd\u83b7\u53d6\u5230\u8eab\u4efd\u6743\u9650\uff0c\u662f\u56e0\u4e3a\u5728\u767b\u5f55\u65f6\u8bbe\u7f6e\u4e86\u6743\u9650\uff1a")),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"SecurityContextHolder.getContext().setAuthentication(authenticate);\n"))),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u643a\u5e26@Component\u6ce8\u89e3")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"@Component\npublic class JwtAuthenticationTokenFilter extends OncePerRequestFilter {\n\n    @Resource\n    JWTUtil jwtUtil;\n\n    @Resource\n    MyUserDetailService userDetailService;\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request,\n                                    HttpServletResponse response,\n                                    FilterChain filterChain) throws ServletException, IOException {\n        String token = request.getHeader(jwtUtil.getHeader());\n        if (token != null && StrUtil.isNotEmpty(token)) {\n            String username = jwtUtil.getUsernameFromToken(token);\n            // JWT\u4e2d\u63d0\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u5e76\u4e14\u8be5\u7528\u6237\u672a\u88ab\u6388\u6743\n            if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {\n                UserDetails userDetails = userDetailService.loadUserByUsername(username);\n                if (jwtUtil.validateToken(token, userDetails)) {\n                    //\u7ed9\u4f7f\u7528\u8be5JWT\u4ee4\u724c\u7684\u7528\u6237\u8fdb\u884c\u6388\u6743\n                    UsernamePasswordAuthenticationToken authenticationToken =\n                            new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());\n                    SecurityContextHolder.getContext().setAuthentication(authenticationToken);\n                }\n            }\n        }\n        filterChain.doFilter(request, response);\n    }\n}\n")),(0,r.kt)("h3",{id:"\u914d\u7f6ecors\u89e3\u51b3\u8de8\u7ad9\u8bbf\u95ee"},"\u914d\u7f6eCORS\u89e3\u51b3\u8de8\u7ad9\u8bbf\u95ee"),(0,r.kt)("p",null,"\u5728spring security\u7684WebSecurityConfigurerAdapter\u4e2d\u7684configure(HttpSecurity http)\u914d\u7f6e\u65b9\u6cd5\uff0c\u52a0\u4e0ahttp.cors()\u914d\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class WebSecurityConfig extends WebSecurityConfigurerAdapter {\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.cors().and()\n        ...\n    }\n}\n")),(0,r.kt)("p",null,"\u540c\u6837\u5728\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0cSpring Security\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b0\u7684CORS\u89c4\u5219\u7684\u914d\u7f6e\u65b9\u6cd5\uff1aCorsConfigurationSource \u3002\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u5b9e\u73b0\u7684\u6548\u679c\u7b49\u540c\u4e8e\u6ce8\u5165\u4e00\u4e2aCorsFilter\u8fc7\u6ee4\u5668\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Bean\nCorsConfigurationSource corsConfigurationSource() {\n    CorsConfiguration configuration = new CorsConfiguration();\n    configuration.setAllowedOrigins(Arrays.asList("http://localhost:8888"));\n    configuration.setAllowedMethods(Arrays.asList("GET","POST"));\n    configuration.applyPermitDefaultValues();\n    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n    source.registerCorsConfiguration("/**", configuration);\n    return source;\n}\n')))}c.isMDXComponent=!0},51243:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/authentication_detail-d47fcde5533ba5e606b3ced775895bdc.png"},67514:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/authentication_flowpng-8b5be7e9b9e354ba3da1bd670e106fb1.png"},74489:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/base64-0934919dd683cf782a4719514fa54865.png"}}]);