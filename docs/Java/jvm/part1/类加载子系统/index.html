<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Java/jvm/part1/类加载子系统">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">类加载子系统 | Computer Science Learn Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zhiyu1998.github.io/Computer-Science-Learn-Notes/docs/Java/jvm/part1/类加载子系统"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="类加载子系统 | Computer Science Learn Notes"><meta data-rh="true" name="description" content="[toc]"><meta data-rh="true" property="og:description" content="[toc]"><link data-rh="true" rel="icon" href="/Computer-Science-Learn-Notes/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zhiyu1998.github.io/Computer-Science-Learn-Notes/docs/Java/jvm/part1/类加载子系统"><link data-rh="true" rel="alternate" href="https://zhiyu1998.github.io/Computer-Science-Learn-Notes/docs/Java/jvm/part1/类加载子系统" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://zhiyu1998.github.io/Computer-Science-Learn-Notes/docs/Java/jvm/part1/类加载子系统" hreflang="x-default"><link rel="stylesheet" href="/Computer-Science-Learn-Notes/assets/css/styles.e7823470.css">
<link rel="preload" href="/Computer-Science-Learn-Notes/assets/js/runtime~main.2f2caf3c.js" as="script">
<link rel="preload" href="/Computer-Science-Learn-Notes/assets/js/main.bdc64bbc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Computer-Science-Learn-Notes/"><div class="navbar__logo"><img src="/Computer-Science-Learn-Notes/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Computer-Science-Learn-Notes/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Computer Science Learn Notes</b></a><a class="navbar__item navbar__link" href="/Computer-Science-Learn-Notes/docs/intro">主页</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Computer-Science-Learn-Notes/docs/golang/learnInProblem">目录</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Computer-Science-Learn-Notes/docs/golang/learnInProblem">Go语言</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Computer-Science-Learn-Notes/docs/frontend/react/">前端</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Computer-Science-Learn-Notes/docs/fundamental/datastruct">基础知识</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/basic/">Java基础</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/basic/">基础知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/concurrent/">并发编程</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/简介">虚拟机</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/简介">简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/类加载子系统">类加载子系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/运行时数据区">运行时数据区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/程序计数器（PC寄存器）">程序计数器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/虚拟机栈">虚拟机栈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/本地方法接口">本地方法接口</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/本地方法栈">本地方法栈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/堆">堆</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/方法区">方法区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/对象的实例化内存布局与访问定位">对象的实例化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/直接内存">直接内存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/执行引擎">执行引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/StringTable">StringTable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/垃圾回收概述">垃圾回收概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/垃圾回收相关算法">垃圾回收相关算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/垃圾回收相关概念">垃圾回收相关概念</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/垃圾回收器">垃圾回收器</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/fm/Spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/fm/SpringMVC">SpringMVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/fm/Mybatis">Mybatis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/fm/SpringBoot">SpringBoot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/fm/SpringDataJpa">SpringDataJpa</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/fm/SpringSecurity">SpringSecurity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/fm/SpringCloud">SpringCloud</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/kotlin/">Kotlin with Spring</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Computer-Science-Learn-Notes/docs/Java/eightpart/giant">Java面试</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Computer-Science-Learn-Notes/docs/others/personal_tech">其他分享</a></div></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/Computer-Science-Learn-Notes/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">目录</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Java基础</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">虚拟机</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">类加载子系统</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>类加载子系统</h1></header><p>[toc]</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内存结构概述">内存结构概述<a href="#内存结构概述" class="hash-link" aria-label="内存结构概述的直接链接" title="内存结构概述的直接链接">​</a></h2><p><img loading="lazy" alt="image" src="/Computer-Science-Learn-Notes/assets/images/F2gmY2By3QS-gciYy9TY1PHvg7b882orQ8wLK67Gg9E-0c9421a85a88ac9e0e82add2c9190123.png" width="1669" height="1579" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="类加载器子系统的作用">类加载器子系统的作用<a href="#类加载器子系统的作用" class="hash-link" aria-label="类加载器子系统的作用的直接链接" title="类加载器子系统的作用的直接链接">​</a></h2><p><img loading="lazy" alt="image" src="/Computer-Science-Learn-Notes/assets/images/80NCg5-HCLDT89aLjSlpcs3KArs7Dr8cmhF3UcnZEcI-b482e4f79991a8efdc11cd1df50d04a5.png" width="999" height="360" class="img_ev3q"></p><ul><li>类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识。</li><li>ClassLoader只负责class文件的加载，至于它是否可以运行，则由ExecutionEngine决定。</li><li>加载的类信息存放于一块称为方法区的内存空间。除了类的信息外，方法区中还会存放运行时常量池信息，可能还包括字符串字面量和数字常量(这部分常量信息是Class文件中常量池部分的内存映射)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="类加载过程----3个阶段">类加载过程 -- 3个阶段<a href="#类加载过程----3个阶段" class="hash-link" aria-label="类加载过程 -- 3个阶段的直接链接" title="类加载过程 -- 3个阶段的直接链接">​</a></h2><p><img loading="lazy" alt="image" src="/Computer-Science-Learn-Notes/assets/images/v7DcvnhSU_REDrJG5SEB1UDaNvwyLvx9mzBWL3yojl8-a5eeef6158cf127e35d8c294a52e6ce1.png" width="1103" height="362" class="img_ev3q"></p><p><img loading="lazy" alt="image" src="/Computer-Science-Learn-Notes/assets/images/Ml0M_GWWv9Ew32uRb--3_nX3lprdBoTj3EoJKbdpRVs-35a16ebcf148f10e38a16314463fde03.png" width="1365" height="1087" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载过程1loading">加载过程1：loading<a href="#加载过程1loading" class="hash-link" aria-label="加载过程1：loading的直接链接" title="加载过程1：loading的直接链接">​</a></h3><ol><li>通过一个类的全限定名获取定义此类的二进制字节流</li><li>将这个字节流所代表的静态存储结构转换为方法区的运行时数据结构</li><li>在内存中生成一个代表这个类的Java.lang.Class对象，作为方法区这个类的各种数据的访问入口</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载过程2linking">加载过程2：Linking<a href="#加载过程2linking" class="hash-link" aria-label="加载过程2：Linking的直接链接" title="加载过程2：Linking的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="验证verify">验证(Verify)<a href="#验证verify" class="hash-link" aria-label="验证(Verify)的直接链接" title="验证(Verify)的直接链接">​</a></h4><ul><li>目的在于确保cClass文件的字节流中包含信息符合当前虚拟机要求，保证被加载类的正确性，不会危害虚拟机自身安全。</li><li>主要包括四种验证，文件格式验证，元数据验证，字节码验证，符号引用验证。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="准备prepare">准备(Prepare)<a href="#准备prepare" class="hash-link" aria-label="准备(Prepare)的直接链接" title="准备(Prepare)的直接链接">​</a></h4><ul><li>为类变量分配内存并且设置该类变量的默认初始值，即零值。</li><li>这里不包含用final修饰的static,因为final在编译的时候就会分配了，准备阶段会显式初始化;</li><li>这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解析resolve">解析(Resolve)<a href="#解析resolve" class="hash-link" aria-label="解析(Resolve)的直接链接" title="解析(Resolve)的直接链接">​</a></h4><ul><li>将常量池内的符号引用转换为直接引用的过程。</li><li>事实上，解析操作往往会伴随着JVM在执行完初始化之后再执行。</li><li>符号引用就是一组符号来描述所引用的目标。符号引用的字面量形式明确定义在《java虚拟机规范》的Class文件格式中。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。</li><li>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT Class info、 CONSTANT Fieldref info、 CONSTANT Methodref info等 </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="类的加载过程initialization">类的加载过程：initialization<a href="#类的加载过程initialization" class="hash-link" aria-label="类的加载过程：initialization的直接链接" title="类的加载过程：initialization的直接链接">​</a></h3><ul><li>初始化阶段就是执行类构造器方法<code>&lt;clinit&gt;</code> ()的过程。</li><li>此方法不需定义，是javac编译器自动收集类中的所有类变量的赋值动作和静态代码块中的语句合并而来。</li><li>构造器方法中指令按语句在源文件中出现的顺序执行。</li><li><code>&lt;clinit&gt;</code>()不同于类的构造器。(关联: 构造器是虚拟机视角下的<code>&lt;init&gt;</code>())</li><li>若该类具有父类，JVM会 保证子类的<code>&lt;clinit&gt;</code>()执行前，父类的<code>&lt;clinit&gt;</code> ()已经执行完毕。</li><li>虚拟机必须保证一个类的<code>&lt;clinit&gt;</code>()方法在多线程下被同步加锁。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="clinit的使用">Clinit的使用<a href="#clinit的使用" class="hash-link" aria-label="Clinit的使用的直接链接" title="Clinit的使用的直接链接">​</a></h4><p>当Java代码为这样时</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClassInitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int num = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(ClassInitTest.num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>clinit会显示字节码为：</p><blockquote><p>提示：当int取值<strong>-1<!-- -->~<!-- -->5</strong>时，JVM采用<strong>iconst</strong>指令将常量压入栈中。</p></blockquote><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0 iconst_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 putstatic #3 &lt;chapter02/ClassInitTest.num : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 return</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当Java代码为这样时（加入static 并修改了原先的值）：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClassInitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int num = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(ClassInitTest.num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>clinit显示字节码：</p><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0 iconst_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 putstatic #3 &lt;chapter02/ClassInitTest.num : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 iconst_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 putstatic #3 &lt;chapter02/ClassInitTest.num : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 return</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当在原先代码中加入number（&gt;5）之后：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClassInitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int num = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number = 20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int number = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(ClassInitTest.num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>clinit显示字节码为：</p><blockquote><p>提示：当int取值<strong>-128<!-- -->~<!-- -->127</strong>时，JVM采用<strong>bipush</strong>指令将常量压入栈中。</p></blockquote><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> 0 iconst_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 putstatic #3 &lt;chapter02/ClassInitTest.num : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 4 iconst_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 5 putstatic #3 &lt;chapter02/ClassInitTest.num : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 8 bipush 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 putstatic #5 &lt;chapter02/ClassInitTest.number : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13 bipush 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">15 putstatic #5 &lt;chapter02/ClassInitTest.number : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18 return</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="非法的前向引用">非法的前向引用<a href="#非法的前向引用" class="hash-link" aria-label="非法的前向引用的直接链接" title="非法的前向引用的直接链接">​</a></h4><p>当调用num时能顺利看到结果，如果在static中再次调用print -- number的结果，则会报非法前向调用的错误</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClassInitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int num = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number = 20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(number); // 报错：非法前向引用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int number = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(ClassInitTest.num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="理解clinit不同于类的构造器">理解<code>&lt;clinit&gt;</code>()不同于类的构造器<a href="#理解clinit不同于类的构造器" class="hash-link" aria-label="理解clinit不同于类的构造器的直接链接" title="理解clinit不同于类的构造器的直接链接">​</a></h4><p>示例：当前代码没有静态变量和静态代码块</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClinitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int a = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int b = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时没有clinit（javac编译器自动收集类中的所有类变量的赋值动作和静态代码块中的语句合并而来）</p><p><img loading="lazy" alt="image" src="/Computer-Science-Learn-Notes/assets/images/DpmBYyvH6NPQ9HV5vnJv-7b6WCbq8dRFMV1ccOQEzZM-b175f9cd5c3df4ad356b623041ceb250.png" width="627" height="184" class="img_ev3q">
加入static以后</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClinitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int a = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int c = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int b = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时就会生成一个clinit</p><p><img loading="lazy" alt="image" src="/Computer-Science-Learn-Notes/assets/images/jIUbpYnfcGfXm249hCEv9E_nyMygqsrlV1o25JGiNd4-6757560d78c155feb87b3134c59f4d8b.png" width="642" height="223" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="构造器在jvm的字节码">构造器在JVM的字节码<a href="#构造器在jvm的字节码" class="hash-link" aria-label="构造器在JVM的字节码的直接链接" title="构造器在JVM的字节码的直接链接">​</a></h4><p>任何一个类声明以后，内部至少存在一个类的构造器：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClinitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 任何一个类声明以后，内部至少存在一个类的构造器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int a = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int c = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int b = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在  init  中的字节码显示为：</p><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0 aload_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 invokespecial #1 &lt;java/lang/Object.&lt;init&gt; : ()V&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 aload_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 iconst_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 putfield #2 &lt;chapter02/ClinitTest.a : I&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9 return</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="具有父类jvm会-保证子类的clinit执行前父类的clinit-已经执行完毕">具有父类，JVM会 保证子类的<code>&lt;clinit&gt;</code>()执行前，父类的<code>&lt;clinit&gt; </code>()已经执行完毕<a href="#具有父类jvm会-保证子类的clinit执行前父类的clinit-已经执行完毕" class="hash-link" aria-label="具有父类jvm会-保证子类的clinit执行前父类的clinit-已经执行完毕的直接链接" title="具有父类jvm会-保证子类的clinit执行前父类的clinit-已经执行完毕的直接链接">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ClinitTest1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static class Father {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static int A = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            A = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static class Son extends Father {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static int B = A;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 加载Father, 加载Son</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(Son.B); // 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如上代码，加载流程如下：</p><ul><li>首先，执行 main() 方法需要加载 ClinitTest1 类</li><li>获取 Son.B 静态变量，需要加载 Son 类</li><li>Son 类的父类是 Father 类，所以需要先执行 Father 类的加载，再执行 Son 类的加载</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="虚拟机必须保证一个类只会加载一次同步加锁">虚拟机必须保证一个类只会加载一次（同步加锁）<a href="#虚拟机必须保证一个类只会加载一次同步加锁" class="hash-link" aria-label="虚拟机必须保证一个类只会加载一次（同步加锁）的直接链接" title="虚拟机必须保证一个类只会加载一次（同步加锁）的直接链接">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class DeadThreadTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Runnable r = () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(Thread.currentThread().getName() + &quot;开始&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DeadTread dead = new DeadTread();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(Thread.currentThread().getName() + &quot;结束&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread t1 = new Thread(r, &quot;线程1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread t2 = new Thread(r, &quot;线程2&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t1.start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t2.start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DeadTread {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(Thread.currentThread().getName() + &quot;初始化当前类&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行结果：</p><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">线程1开始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">线程2开始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">线程1初始化当前类</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>程序卡死，分析原因：</p><ul><li>两个线程同时去加载 DeadThread 类，而 DeadThread 类中静态代码块中有一处死循环</li><li>先加载 DeadThread 类的线程抢到了同步锁，然后在类的静态代码块中执行死循环，而另一个线程在等待同步锁的释放</li><li>所以无论哪个线程先执行 DeadThread 类的加载，另外一个类也不会继续执行。（一个类只会被加载一次）</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="类加载器的分类">类加载器的分类<a href="#类加载器的分类" class="hash-link" aria-label="类加载器的分类的直接链接" title="类加载器的分类的直接链接">​</a></h2><p><img loading="lazy" alt="image" src="data:image/png;base64,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" width="447" height="234" class="img_ev3q"></p><p>系统提供了 3 种类加载器：</p><ul><li>启动类加载器（Bootstrap ClassLoader）</li><li>扩展类加载器（Extension ClassLoader）</li><li>应用程序类加载器（Application ClassLoader）</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取系统类加载器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(systemClassLoader); // sun.misc.Launcher$AppClassLoader@18b4aac2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取其上层：扩展类加载器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClassLoader extClassLoader = systemClassLoader.getParent();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(extClassLoader); // sun.misc.Launcher$ExtClassLoader@1b6d3586</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取其上层：启动类加载器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClassLoader bootstrapClassLoader = extClassLoader.getParent();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(bootstrapClassLoader); // null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 用户自定义类: 使用系统类加载器进行加载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClassLoader classLoader = ClassLoaderTest.class.getClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(classLoader); // sun.misc.Launcher$AppClassLoader@18b4aac2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // String使用的是启动类加载器 -----&gt; JAVA的核心类库都是使用引导类加载器进行加载的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClassLoader stringClassLoader = String.class.getClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(stringClassLoader); // null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="启动类加载器">启动类加载器<a href="#启动类加载器" class="hash-link" aria-label="启动类加载器的直接链接" title="启动类加载器的直接链接">​</a></h4><blockquote><p><strong>启动类加载器（引导类加载器，Bootstrap ClassLoader）</strong></p></blockquote><ol><li>这个类加载使用C/C++语言实现的，嵌套在JVM内部</li><li>它用来加载Java的核心库即负责将存放在 <code>&lt;JAVA_HOME&gt;\lib</code>（JAVA<!-- -->_<!-- -->HOME/jre/lib/rt.jar、resources.jar或sun.boot.class.path路径下的内容），用于提供JVM自身需要的类</li><li>并不继承自java.lang.ClassLoader，没有父加载器</li><li>加载扩展类和应用程序类加载器，并作为他们的父类加载器</li><li>出于安全考虑，Bootstrap启动类加载器只加载包名为java、javax、sun等开头的类</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="扩展类加载器">扩展类加载器<a href="#扩展类加载器" class="hash-link" aria-label="扩展类加载器的直接链接" title="扩展类加载器的直接链接">​</a></h4><blockquote><p><strong>扩展类加载器（Extension ClassLoader）</strong></p></blockquote><ol><li>Java语言编写，由sun.misc.Launcher\$ExtClassLoader实现</li><li>派生于ClassLoader类</li><li>父类加载器为启动类加载器</li><li>从java.ext.dirs系统属性所指定的目录中加载类库，或负责加载 <code>&lt;JAVA_HOME&gt;\lib\ext</code> 目录中的所有类库。如果用户创建的JAR放在此目录下，也会自动由扩展类加载器加载</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="系统类加载器">系统类加载器<a href="#系统类加载器" class="hash-link" aria-label="系统类加载器的直接链接" title="系统类加载器的直接链接">​</a></h4><blockquote><p><strong>应用程序类加载器（也称为系统类加载器，AppClassLoader）</strong></p></blockquote><ol><li>Java语言编写，由sun.misc.LaunchersAppClassLoader实现</li><li>派生于ClassLoader类</li><li>父类加载器为扩展类加载器</li><li>它负责加载环境变量classpath或系统属性java.class.path指定路径下的类库</li><li>该类加载是程序中默认的类加载器，一般来说，Java应用的类都是由它来完成加载</li><li>通过classLoader.getSystemclassLoader()方法可以获取到该类加载器</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="查看加载器">查看加载器<a href="#查看加载器" class="hash-link" aria-label="查看加载器的直接链接" title="查看加载器的直接链接">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(&quot;*****************启动类加载器*****************&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 获取BootstrapClassLoader能够加载的api路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">URL[] urls = Launcher.getBootstrapClassPath().getURLs();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (URL url : urls) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(url.toExternalForm());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出结果：</p><div class="language-Plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">*****************启动类加载器*****************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/lib/resources.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/lib/rt.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/lib/sunrsasign.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/lib/jsse.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/lib/jce.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/lib/charsets.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/lib/jfr.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file:/D:/Software/Java/jdk1.8.0_321/jre/classes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>验证这些jar中的某个类是否是这个加载器所加载的：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ClassLoader classLoader = Provider.class.getClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(classLoader); // null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同理可以验证扩展类加载器：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">String extDirs = System.getProperty(&quot;java.ext.dirs&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (String path : extDirs.split(&quot;;&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(path);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 从上面的路径中随意选择一个类，看看他的类加载器是什么:引导类加载器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClassLoader classLoader1 = Point.class.getClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(classLoader1); // sun.misc.Launcher$ExtClassLoader@38af3868</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="用户自定义加载器">用户自定义加载器<a href="#用户自定义加载器" class="hash-link" aria-label="用户自定义加载器的直接链接" title="用户自定义加载器的直接链接">​</a></h4><p>在Java的日常应用程序开发中，类的加载几乎是由上述3种类加载器相互配合执行的，在必要时，我们还可以自定义类加载器，来定制类的加载方式。那为什么还需要自定义类加载器？</p><ol><li>隔离加载类（比如说我假设现在Spring框架，和RocketMQ有包名路径完全一样的类，类名也一样，这个时候类就冲突了。不过一般的主流框架和中间件都会自定义类加载器，实现不同的框架，中间价之间是隔离的）</li><li>修改类加载的方式</li><li>扩展加载源（还可以考虑从数据库中加载类，路由器等等不同的地方）</li><li>防止源码泄漏（对字节码文件进行解密，自己用的时候通过自定义类加载器来对其进行解密）</li></ol><p>如何自己自定义类加载器：</p><ol><li>开发人员可以通过继承抽象类java.lang.ClassLoader类的方式，实现自己的类加载器，以满足一些特殊的需求</li><li>在JDK1.2之前，在自定义类加载器时，总会去继承ClassLoader类并重写loadClass()方法，从而实现自定义的类加载类，但是在JDK1.2之后已不再建议用户去覆盖loadClass()方法，而是建议把自定义的类加载逻辑写在findclass()方法中</li><li>在编写自定义类加载器时，如果没有太过于复杂的需求，可以直接继承URIClassLoader类，这样就可以避免自己去编写findclass()方法及其获取字节码流的方式，使自定义类加载器编写更加简洁。</li></ol><p>示例：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomClassLoader extends ClassLoader {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] result = getClassFromCustomPath(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (result == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new FileNotFoundException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //defineClass和findClass搭配使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return defineClass(name, result, 0, result.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (FileNotFoundException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new ClassNotFoundException(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //自定义流的获取方式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private byte[] getClassFromCustomPath(String name) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //从自定义路径中加载指定类:细节略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //如果指定路径的字节码文件进行了加密，则需要在此方法中进行解密操作。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CustomClassLoader customClassLoader = new CustomClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt; clazz = Class.forName(&quot;One&quot;, true, customClassLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object obj = clazz.newInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(obj.getClass().getClassLoader());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="双亲委派机制">双亲委派机制<a href="#双亲委派机制" class="hash-link" aria-label="双亲委派机制的直接链接" title="双亲委派机制的直接链接">​</a></h2><p>JVM中提供了三层的ClassLoader：</p><ul><li><strong>Bootstrap classLoader</strong>:主要负责加载核心的类库(java.lang.<!-- -->*<!-- -->等)，构造ExtClassLoader和APPClassLoader。</li><li><strong>ExtClassLoader</strong>：主要负责加载jre/lib/ext目录下的一些扩展的jar。</li><li><strong>AppClassLoader</strong>：主要负责加载应用程序的主函数类</li></ul><p>解释：Java虚拟机对class文件采用的是<strong>按需加载</strong>的方式，也就是说当需要使用该类时才会将它的class文件加载到内存生成class对象。而且加载某个类的class文件时，Java虚拟机采用的是双亲委派模式，即把请求交由父类处理，它是一种任务委派模式</p><ol><li>如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</li><li>如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器；</li><li>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派模式。</li><li>父类加载器一层一层往下分配任务，如果子类加载器能加载，则加载此类，如果将加载任务分配至系统类加载器也无法加载此类，则抛出异常</li></ol><p><img loading="lazy" alt="image" src="/Computer-Science-Learn-Notes/assets/images/zAq83MJACWiiiWf3NUq14jrHI5zVomyxj1TSgdRqLdY-7ad6f4769dd6a58ea3ca4d28114513a7.png" width="1312" height="1240" class="img_ev3q"></p><p><strong>理解：</strong>当一个Hello.class这样的文件要被加载时。不考虑我们自定义类加载器，首先会在AppClassLoader中检查是否加载过，如果有那就无需再加载了。如果没有，那么会拿到父加载器，然后调用父加载器的loadClass方法。父类中同理也会先检查自己是否已经加载过，如果没有再往上。注意这个类似递归的过程，直到到达Bootstrap classLoader之前，都是在检查是否加载过，并不会选择自己去加载。直到BootstrapClassLoader，已经没有父加载器了，这时候开始考虑自己是否能加载了，如果自己无法加载，会下沉到子加载器去加载，一直到最底层，如果没有任何加载器能加载，就会抛出ClassNotFoundException。</p><p><strong>设计的好处：</strong>这种设计有个好处是，如果有人想替换系统级别的类：String.java。篡改它的实现，在这种机制下这些系统的类已经被Bootstrap classLoader加载过了（为什么？因为当一个类需要加载的时候，最先去尝试加载的就是BootstrapClassLoader），所以其他类加载器并没有机会再去加载，从一定程度上防止了危险代码的植入。</p><p>小结优势：</p><ol><li>避免类的重复加载</li><li>保护程序安全，防止核心API被随意篡改</li></ol><ul><li>自定义类：自定义java.lang.String 没有被加载。</li><li>自定义类：java.lang.ShkStart（报错：阻止创建 java.lang开头的类）</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例">示例<a href="#示例" class="hash-link" aria-label="示例的直接链接" title="示例的直接链接">​</a></h3><p>如果在包下创建一个java.lang.String的类：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package java.lang;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class String {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // static在初始化阶段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;我是自定义的String类的静态代码块&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 错误: 在类 java.lang.String 中找不到 main 方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里String类已经被加载过了，方法区已经有该类对象，但是该类对象没有main方法，所以报了这个错误</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;Hello. String&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在另外的程序中加载 String 类，看看加载的 String 类是 JDK 自带的 String 类，还是我们自己编写的 String 类</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class StringTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String str = new String();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;hello, zhiyucs.cn&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringTest test = new StringTest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(test.getClass().getClassLoader());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出结果：可见仍然加载的是 JDK 自带的 String 类</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hello, zhiyucs.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="沙箱安全机制">沙箱安全机制<a href="#沙箱安全机制" class="hash-link" aria-label="沙箱安全机制的直接链接" title="沙箱安全机制的直接链接">​</a></h2><ul><li>自定义String类时：在加载自定义String类的时候会率先使用引导类加载器加载，而引导类加载器在加载的过程中会先加载jdk自带的文件（rt.jar包中java.lang.String.class），报错信息说没有main方法，就是因为加载的是rt.jar包中的String类。</li><li>这样可以保证对java核心源代码的保护，这就是沙箱安全机制。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="其他的直接链接" title="其他的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何判断两个class对象是否相同">如何判断两个class对象是否相同？<a href="#如何判断两个class对象是否相同" class="hash-link" aria-label="如何判断两个class对象是否相同？的直接链接" title="如何判断两个class对象是否相同？的直接链接">​</a></h3><p>在JVM中表示两个class对象是否为同一个类存在两个必要条件：</p><ol><li>类的完整类名必须一致，包括包名</li><li><strong>加载这个类的ClassLoader（指ClassLoader实例对象）必须相同</strong></li><li>换句话说，在JVM中，即使这两个类对象（class对象）来源同一个Class文件，被同一个虚拟机所加载，但只要加载它们的ClassLoader实例对象不同，那么这两个类对象也是不相等的</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="对类加载器的引用">对类加载器的引用<a href="#对类加载器的引用" class="hash-link" aria-label="对类加载器的引用的直接链接" title="对类加载器的引用的直接链接">​</a></h3><ol><li>JVM必须知道一个类型是由启动加载器加载的还是由用户类加载器加载的</li><li><strong>如果一个类型是由用户类加载器加载的，那么JVM会将这个类加载器的一个引用作为类型信息的一部分保存在方法区中</strong></li><li>当解析一个类型到另一个类型的引用的时候，JVM需要保证这两个类型的类加载器是相同的（后面讲）</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zhiyu1998/Computer-Science-Learn-Notes/edit/master/docs/Java/jvm/part1/2.类加载子系统.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/简介"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">简介</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Computer-Science-Learn-Notes/docs/Java/jvm/part1/运行时数据区"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">运行时数据区</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#内存结构概述" class="table-of-contents__link toc-highlight">内存结构概述</a></li><li><a href="#类加载器子系统的作用" class="table-of-contents__link toc-highlight">类加载器子系统的作用</a></li><li><a href="#类加载过程----3个阶段" class="table-of-contents__link toc-highlight">类加载过程 -- 3个阶段</a><ul><li><a href="#加载过程1loading" class="table-of-contents__link toc-highlight">加载过程1：loading</a></li><li><a href="#加载过程2linking" class="table-of-contents__link toc-highlight">加载过程2：Linking</a></li><li><a href="#类的加载过程initialization" class="table-of-contents__link toc-highlight">类的加载过程：initialization</a></li></ul></li><li><a href="#类加载器的分类" class="table-of-contents__link toc-highlight">类加载器的分类</a></li><li><a href="#双亲委派机制" class="table-of-contents__link toc-highlight">双亲委派机制</a><ul><li><a href="#示例" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#沙箱安全机制" class="table-of-contents__link toc-highlight">沙箱安全机制</a></li><li><a href="#其他" class="table-of-contents__link toc-highlight">其他</a><ul><li><a href="#如何判断两个class对象是否相同" class="table-of-contents__link toc-highlight">如何判断两个class对象是否相同？</a></li><li><a href="#对类加载器的引用" class="table-of-contents__link toc-highlight">对类加载器的引用</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Computer-Science-Learn-Notes/docs/intro">主页</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="#" class="footer__link-item">莫得</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/zhiyu1998" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Computer Science Learn Notes, Inc. Built with Zhiyu1998.</div></div></div></footer></div>
<script src="/Computer-Science-Learn-Notes/assets/js/runtime~main.2f2caf3c.js"></script>
<script src="/Computer-Science-Learn-Notes/assets/js/main.bdc64bbc.js"></script>
</body>
</html>